# Feature Specification: TradingView 风格交易界面核心组件

**Feature Branch**: `001-trading-ui-components`
**Created**: 2025-10-24
**Status**: Draft
**Input**: 实现 TradingView 风格的交易界面核心组件，包括 K线图表、交易面板（买入/卖出）、持仓列表、交易历史和股票搜索功能

## User Scenarios & Testing

### User Story 1 - 查看股票实时行情与K线图表 (Priority: P1)

用户需要查看股票的实时价格走势和历史K线数据，以便做出交易决策。用户在左侧股票列表中选择一只股票后，中间区域显示该股票的K线图表，包括开盘价、收盘价、最高价、最低价等信息，支持不同时间周期的切换（日K、周K、月K）。

**Why this priority**: K线图表是交易决策的核心工具，没有图表展示，用户无法分析股票走势，这是交易系统最基础的功能。

**Independent Test**: 用户选择任意股票后，图表区域立即显示该股票的K线数据，可以独立验证图表渲染、数据加载和交互功能。

**Acceptance Scenarios**:

1. **Given** 用户在交易页面，**When** 用户在左侧列表中点击一只股票，**Then** 中间区域显示该股票的K线图表，包含当前价格、涨跌幅和成交量
2. **Given** K线图表已显示，**When** 用户切换时间周期（日K/周K/月K），**Then** 图表更新为对应周期的K线数据
3. **Given** K线图表已显示，**When** 用户将鼠标悬停在K线上，**Then** 显示该时间点的详细数据（开高低收、成交量）
4. **Given** K线图表已显示，**When** 用户拖动图表或缩放，**Then** 图表平滑响应，显示不同时间范围的数据

---

### User Story 2 - 快速执行买入/卖出交易 (Priority: P1)

用户需要快速执行股票买卖操作。用户在右侧交易面板中输入股票代码（或从图表区域自动填充）、价格和数量后，系统验证交易参数并执行交易，实时更新账户余额和持仓信息。

**Why this priority**: 交易执行是核心业务功能，直接影响用户体验和系统价值。快速便捷的交易流程是专业交易系统的标志。

**Independent Test**: 用户完成交易表单填写并提交后，系统能够独立执行交易操作，更新账户状态，并提供交易结果反馈。

**Acceptance Scenarios**:

1. **Given** 用户在交易页面且账户余额充足，**When** 用户在右侧面板选择"买入"，输入股票代码、价格和数量后点击"确认买入"，**Then** 系统显示交易确认对话框，确认后执行交易并更新账户余额
2. **Given** 用户持有某只股票，**When** 用户在右侧面板选择"卖出"，输入该股票代码、价格和数量后点击"确认卖出"，**Then** 系统验证持仓数量，执行卖出并更新持仓和账户余额
3. **Given** 用户输入的买入金额超过账户余额，**When** 用户点击"确认买入"，**Then** 系统显示"余额不足"错误提示，阻止交易执行
4. **Given** 用户输入的卖出数量超过持仓数量，**When** 用户点击"确认卖出"，**Then** 系统显示"持仓不足"错误提示，阻止交易执行
5. **Given** 用户已选择某只股票，**When** 用户点击右侧交易面板，**Then** 股票代码和当前价格自动填充到交易表单中

---

### User Story 3 - 查看持仓列表与盈亏统计 (Priority: P2)

用户需要实时查看所有持仓股票的盈亏情况。在底部"持仓"标签页中，显示所有持仓股票的代码、名称、持有数量、成本价、当前价、市值、盈亏金额和盈亏比例，盈亏以颜色区分（盈利绿色、亏损红色）。

**Why this priority**: 持仓管理是用户评估投资表现的关键功能，但可以在基础交易功能完成后再实现。

**Independent Test**: 用户执行买入操作后，持仓列表自动更新，显示新增持仓及实时盈亏，可独立验证持仓计算逻辑。

**Acceptance Scenarios**:

1. **Given** 用户持有多只股票，**When** 用户打开"持仓"标签页，**Then** 显示所有持仓的详细信息，包括成本、市值和盈亏
2. **Given** 持仓列表已显示，**When** 股票价格实时更新，**Then** 盈亏金额和比例实时计算并更新显示
3. **Given** 持仓列表已显示，**When** 用户点击某一持仓行，**Then** 中间图表区域切换到该股票的K线图，右侧交易面板自动填充该股票信息并切换到"卖出"模式
4. **Given** 用户卖出全部持仓后，**When** 持仓列表更新，**Then** 该股票从持仓列表中移除

---

### User Story 4 - 查看交易历史记录 (Priority: P3)

用户需要查看所有历史交易记录，包括买入和卖出的时间、股票、数量、价格和交易金额。在底部"交易历史"标签页中，按时间倒序显示所有交易记录，支持按股票代码和交易类型筛选。

**Why this priority**: 交易历史是用户复盘和统计的工具，优先级低于实时交易和持仓功能。

**Independent Test**: 用户执行交易后，交易历史标签页显示新增交易记录，可独立验证交易记录的存储和展示。

**Acceptance Scenarios**:

1. **Given** 用户已执行多笔交易，**When** 用户打开"交易历史"标签页，**Then** 显示所有交易记录，按时间倒序排列
2. **Given** 交易历史已显示，**When** 用户在筛选框中输入股票代码，**Then** 只显示该股票的交易记录
3. **Given** 交易历史已显示，**When** 用户选择"买入"筛选条件，**Then** 只显示买入类型的交易记录
4. **Given** 交易历史已显示，**When** 用户滚动到列表底部，**Then** 自动加载更多历史记录（分页加载）

---

### User Story 5 - 搜索并选择股票 (Priority: P2)

用户需要快速搜索并选择股票进行交易。在左侧股票列表顶部提供搜索框，用户输入股票代码或名称关键词时，实时显示匹配的股票列表。用户点击搜索结果后，图表和交易面板自动切换到该股票。

**Why this priority**: 搜索功能提升用户体验，但用户也可以通过浏览列表选择股票，不是最核心功能。

**Independent Test**: 用户在搜索框输入关键词后，搜索结果实时更新，点击结果后成功切换股票，可独立测试搜索逻辑。

**Acceptance Scenarios**:

1. **Given** 用户在交易页面，**When** 用户在左侧搜索框中输入股票代码部分内容（如"6000"），**Then** 实时显示所有代码包含"6000"的股票列表
2. **Given** 用户在搜索框中输入内容，**When** 用户在搜索框中输入股票名称关键词（如"银行"），**Then** 实时显示所有名称包含"银行"的股票列表
3. **Given** 搜索结果已显示，**When** 用户点击某一搜索结果，**Then** 图表区域显示该股票K线图，交易面板自动填充该股票代码和价格
4. **Given** 搜索框中有内容，**When** 用户清空搜索框，**Then** 恢复显示完整的股票列表

---

### Edge Cases

- **股票价格数据缺失**：当某只股票没有K线数据时，图表区域显示"暂无数据"提示，不影响其他功能
- **网络请求失败**：当API请求失败时，显示友好的错误提示（如"加载失败，请稍后重试"），不影响已加载的数据
- **并发交易冲突**：当用户快速连续提交多笔交易时，系统按顺序处理，避免余额计算错误
- **持仓数量为小数**：系统支持小数数量的股票持仓（如0.5股），正确计算成本和盈亏
- **极端价格输入**：用户输入负数价格或极大数值时，系统进行表单验证并提示错误
- **账户余额不足边界情况**：用户输入的交易金额刚好等于账户余额时，允许交易执行
- **持仓清零**：用户卖出全部持仓后，该股票从持仓列表中正确移除，不显示为0持仓

## Requirements

### Functional Requirements

- **FR-001**: 系统必须在左侧显示股票列表，包含股票代码、名称、当前价格和涨跌幅
- **FR-002**: 系统必须在中间区域显示K线图表，支持日K、周K、月K时间周期切换
- **FR-003**: 系统必须在K线图表上显示十字光标，鼠标悬停时显示该时间点的开高低收数据
- **FR-004**: 系统必须在右侧显示交易面板，包含买入和卖出两个模式的表单
- **FR-005**: 系统必须验证交易表单输入，包括股票代码、价格（大于0）和数量（大于0）
- **FR-006**: 系统必须在用户提交交易前显示确认对话框，包含交易详情和预估金额
- **FR-007**: 系统必须在交易执行后立即更新账户余额、持仓列表和交易历史
- **FR-008**: 系统必须在底部显示"持仓"、"交易历史"和"订单"三个标签页
- **FR-009**: 系统必须在持仓列表中实时计算并显示每只股票的盈亏金额和盈亏比例
- **FR-010**: 系统必须使用颜色区分盈亏状态（盈利绿色、亏损红色、持平灰色）
- **FR-011**: 系统必须在交易历史中按时间倒序显示所有交易记录
- **FR-012**: 系统必须支持交易历史的分页加载，每页显示20条记录
- **FR-013**: 系统必须提供股票搜索功能，支持按代码或名称模糊匹配
- **FR-014**: 系统必须在搜索框输入时实时更新搜索结果（防抖延迟300毫秒）
- **FR-015**: 系统必须在用户选择股票后，自动在交易面板中填充股票代码和当前价格
- **FR-016**: 系统必须在交易失败时显示具体的错误信息（如"余额不足"、"持仓不足"）
- **FR-017**: 系统必须保持用户的界面状态（当前选中的股票、图表周期设置、标签页选择）
- **FR-018**: 系统必须在顶部导航栏显示账户名称和可用资金余额
- **FR-019**: 系统必须支持键盘快捷操作（上下方向键选择股票、Enter键确认交易）
- **FR-020**: 系统必须在加载数据时显示加载状态指示器，避免用户等待时的困惑

### Key Entities

- **股票(Asset)**: 代表可交易的资产，包含代码、名称、交易所、资产类型、当前价格等属性
- **持仓(Holding)**: 代表用户持有的股票，包含资产引用、持有数量、平均成本价、当前市值、盈亏金额和盈亏比例
- **交易记录(Trade)**: 代表一笔交易，包含账户引用、资产引用、交易类型（买入/卖出）、数量、价格、交易时间和交易金额
- **账户(Account)**: 代表用户的交易账户，包含账户名称、初始资金、当前可用余额、总资产和盈亏统计
- **K线数据(CandlestickData)**: 代表股票的K线数据点，包含时间戳、开盘价、最高价、最低价、收盘价和成交量

## Success Criteria

### Measurable Outcomes

- **SC-001**: 用户从选择股票到完成交易的整个流程可在30秒内完成
- **SC-002**: K线图表在股票切换时的加载时间不超过1秒
- **SC-003**: 持仓盈亏计算实时更新，延迟不超过500毫秒
- **SC-004**: 搜索功能在输入关键词后300毫秒内显示搜索结果
- **SC-005**: 交易执行成功率达到100%（排除业务规则阻止的交易，如余额不足）
- **SC-006**: 用户界面在1920x1080分辨率下所有元素正确显示，无布局错乱
- **SC-007**: 90%的用户能在首次使用时不需要帮助文档即可完成买入或卖出操作
- **SC-008**: 系统支持同时显示至少50只股票的列表，滚动流畅无卡顿
- **SC-009**: 交易确认对话框在用户点击确认按钮后2秒内完成交易并更新界面
- **SC-010**: 所有交互操作（点击、悬停、输入）的响应时间不超过100毫秒
