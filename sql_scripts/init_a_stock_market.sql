-- ============================================================
-- A股虚拟市场初始化脚本
-- ============================================================
-- 功能：初始化106只虚拟股票，覆盖10大行业板块
-- 特点：
--   - 完整的A股风格代码（600xxx, 000xxx, 300xxx等）
--   - 真实的市值分布（380亿 - 22000亿）
--   - 配置Beta系数（0.65 - 1.80）
--   - 10大行业板块分类
-- ============================================================

-- 清空现有数据（谨慎使用！）
-- TRUNCATE TABLE stock_metadata CASCADE;

-- 插入106只虚拟股票
INSERT INTO stock_metadata (
    symbol,
    name,
    sector,
    base_price,
    base_volatility,
    outstanding_shares,
    market_cap,
    beta,
    is_active,
    listing_date
) VALUES

-- ============================================================
-- 金融板块（12只）- 市值占比28%
-- 特征：低波动、低Beta、高分红、权重股集中
-- ============================================================

-- 超大盘银行股（四大行+股份制银行）
('601398', '国民银行', 'Finance', 6.50, 0.014, 184615384615, 12000, 0.70, TRUE, '2024-01-01'),
('601288', '农业银行', 'Finance', 4.20, 0.015, 261904761905, 11000, 0.69, TRUE, '2024-01-01'),
('601318', '平安保险', 'Finance', 58.00, 0.020, 17241379310, 10000, 0.75, TRUE, '2024-01-01'),
('600036', '招商银行', 'Finance', 42.00, 0.018, 21428571429, 9000, 0.75, TRUE, '2024-01-01'),
('600001', '快乐银行', 'Finance', 15.00, 0.015, 53333333333, 8000, 0.70, TRUE, '2024-01-01'),

-- 中大盘金融股
('601328', '交通银行', 'Finance', 8.20, 0.016, 54878048780, 4500, 0.72, TRUE, '2024-01-01'),
('600016', '民生银行', 'Finance', 4.80, 0.019, 87500000000, 4200, 0.76, TRUE, '2024-01-01'),
('600030', '中信证券', 'Finance', 25.00, 0.025, 15200000000, 3800, 0.85, TRUE, '2024-01-01'),
('601998', '中信银行', 'Finance', 5.60, 0.016, 62500000000, 3500, 0.71, TRUE, '2024-01-01'),
('601166', '城市银行', 'Finance', 9.80, 0.017, 32653061224, 3200, 0.73, TRUE, '2024-01-01'),

-- 中小盘券商
('601688', '华泰证券', 'Finance', 18.50, 0.026, 13513513514, 2500, 0.87, TRUE, '2024-01-01'),
('601066', '中信建设', 'Finance', 12.30, 0.023, 17073170732, 2100, 0.82, TRUE, '2024-01-01'),

-- ============================================================
-- 消费板块（15只）- 市值占比18%
-- 特征：价值股、稳定成长、防御性
-- ============================================================

-- 超大盘消费龙头
('600519', '贵州快乐', 'Consumer', 1680.00, 0.020, 1309523810, 22000, 0.85, TRUE, '2024-01-01'),
('000858', '五粮液', 'Consumer', 168.00, 0.022, 3452380952, 5800, 0.88, TRUE, '2024-01-01'),
('000333', '美的电器', 'Consumer', 72.00, 0.025, 7638888889, 5500, 0.95, TRUE, '2024-01-01'),
('603288', '海天调味', 'Consumer', 88.00, 0.024, 4772727273, 4200, 0.87, TRUE, '2024-01-01'),
('000651', '格力电器', 'Consumer', 35.00, 0.026, 10857142857, 3800, 0.92, TRUE, '2024-01-01'),

-- 中大盘消费股
('600887', '伊利乳业', 'Consumer', 38.00, 0.023, 8421052632, 3200, 0.90, TRUE, '2024-01-01'),
('002304', '洋河酒业', 'Consumer', 128.00, 0.028, 1406250000, 1800, 0.93, TRUE, '2024-01-01'),
('002572', '家居家电', 'Consumer', 52.00, 0.030, 2307692308, 1200, 1.00, TRUE, '2024-01-01'),
('600600', '青岛啤酒', 'Consumer', 78.00, 0.025, 1256410256, 980, 0.89, TRUE, '2024-01-01'),

-- 中小盘消费股
('600809', '快乐服饰', 'Consumer', 22.00, 0.033, 3863636364, 850, 1.08, TRUE, '2024-01-01'),
('002507', '连锁超市', 'Consumer', 18.50, 0.029, 3675675676, 680, 0.97, TRUE, '2024-01-01'),
('603589', '食品饮料', 'Consumer', 35.00, 0.028, 1942857143, 680, 0.96, TRUE, '2024-01-01'),
('603369', '今世缘', 'Consumer', 48.00, 0.027, 1083333333, 520, 0.91, TRUE, '2024-01-01'),
('600779', '全聚德', 'Consumer', 12.00, 0.032, 3500000000, 420, 1.05, TRUE, '2024-01-01'),
('300999', '快乐餐饮', 'Consumer', 28.00, 0.035, 1500000000, 420, 1.12, TRUE, '2024-01-01'),

-- ============================================================
-- 科技板块（20只）- 市值占比22%
-- 特征：高成长、高波动、高Beta
-- ============================================================

-- 大盘科技股
('600520', '云端计算', 'Technology', 180.00, 0.030, 2777777778, 5000, 1.15, TRUE, '2024-01-01'),
('300059', '互联网科技', 'Technology', 68.00, 0.038, 6176470588, 4200, 1.28, TRUE, '2024-01-01'),
('688001', '半导体芯片', 'Technology', 120.00, 0.042, 2916666667, 3500, 1.35, TRUE, '2024-01-01'),
('002415', '视频监控', 'Technology', 48.00, 0.035, 6250000000, 3000, 1.22, TRUE, '2024-01-01'),
('688012', '人工智能', 'Technology', 95.00, 0.045, 2947368421, 2800, 1.40, TRUE, '2024-01-01'),

-- 中盘科技股
('002049', '紫光芯片', 'Technology', 42.00, 0.043, 5238095238, 2200, 1.36, TRUE, '2024-01-01'),
('002230', '通信设备', 'Technology', 38.00, 0.036, 4736842105, 1800, 1.25, TRUE, '2024-01-01'),
('002371', '北方华创', 'Technology', 78.00, 0.048, 2307692308, 1800, 1.42, TRUE, '2024-01-01'),
('300750', '智能硬件', 'Technology', 52.00, 0.040, 2884615385, 1500, 1.32, TRUE, '2024-01-01'),
('300661', '5G通信', 'Technology', 38.00, 0.040, 3552631579, 1350, 1.31, TRUE, '2024-01-01'),

-- 中小盘科技股
('300033', '云存储', 'Technology', 45.00, 0.042, 2666666667, 1200, 1.38, TRUE, '2024-01-01'),
('300456', '大数据', 'Technology', 28.00, 0.041, 3928571429, 1100, 1.33, TRUE, '2024-01-01'),
('603986', '软件开发', 'Technology', 32.00, 0.039, 3062500000, 980, 1.30, TRUE, '2024-01-01'),
('688008', '集成电路', 'Technology', 56.00, 0.052, 1750000000, 980, 1.55, TRUE, '2024-01-01'),
('300308', '网络安全', 'Technology', 28.00, 0.042, 3178571429, 890, 1.34, TRUE, '2024-01-01'),
('603160', '电子元件', 'Technology', 25.00, 0.037, 3520000000, 880, 1.24, TRUE, '2024-01-01'),

-- 小盘科技股
('300142', '物联网', 'Technology', 18.50, 0.044, 3891891892, 720, 1.37, TRUE, '2024-01-01'),
('688111', '量子计算', 'Technology', 88.00, 0.055, 738636364, 650, 1.65, TRUE, '2024-01-01'),
('688036', '工业软件', 'Technology', 42.00, 0.046, 1333333333, 560, 1.45, TRUE, '2024-01-01'),
('688188', '光刻机', 'Technology', 220.00, 0.060, 236363636, 520, 1.75, TRUE, '2024-01-01'),

-- ============================================================
-- 新能源板块（10只）- 市值占比12%
-- 特征：热门赛道、高成长、超高波动
-- ============================================================

-- 大盘新能源龙头
('300750', '新能源汽车', 'NewEnergy', 245.00, 0.045, 3265306122, 8000, 1.50, TRUE, '2024-01-01'),
('002594', '动力电池', 'NewEnergy', 180.00, 0.048, 2500000000, 4500, 1.55, TRUE, '2024-01-01'),
('601012', '光伏科技', 'NewEnergy', 85.00, 0.042, 3764705882, 3200, 1.42, TRUE, '2024-01-01'),

-- 中盘新能源股
('300274', '储能技术', 'NewEnergy', 95.00, 0.050, 2210526316, 2100, 1.58, TRUE, '2024-01-01'),
('600438', '风力发电', 'NewEnergy', 28.00, 0.038, 6428571429, 1800, 1.35, TRUE, '2024-01-01'),
('688599', '锂电材料', 'NewEnergy', 120.00, 0.052, 1250000000, 1500, 1.62, TRUE, '2024-01-01'),
('601865', '太阳能', 'NewEnergy', 18.50, 0.040, 6486486486, 1200, 1.38, TRUE, '2024-01-01'),

-- 中小盘新能源股
('002129', '充电桩', 'NewEnergy', 42.00, 0.046, 2333333333, 980, 1.48, TRUE, '2024-01-01'),
('300014', '氢能源', 'NewEnergy', 35.00, 0.055, 2057142857, 720, 1.68, TRUE, '2024-01-01'),
('688303', '钠电池', 'NewEnergy', 68.00, 0.060, 558823529, 380, 1.80, TRUE, '2024-01-01'),

-- ============================================================
-- 医药板块（12只）- 市值占比8%
-- 特征：防御性、稳健成长
-- ============================================================

-- 大盘医药股
('600276', '生物医药', 'Healthcare', 88.00, 0.025, 4318181818, 3800, 0.95, TRUE, '2024-01-01'),
('300015', '创新药', 'Healthcare', 68.00, 0.032, 4117647059, 2800, 1.12, TRUE, '2024-01-01'),
('000661', '长春制药', 'Healthcare', 45.00, 0.028, 4888888889, 2200, 1.00, TRUE, '2024-01-01'),
('600521', '疫苗研发', 'Healthcare', 78.00, 0.035, 2307692308, 1800, 1.18, TRUE, '2024-01-01'),

-- 中盘医药股
('002007', '华东医药', 'Healthcare', 32.00, 0.026, 4687500000, 1500, 0.97, TRUE, '2024-01-01'),
('603259', '医疗器械', 'Healthcare', 58.00, 0.029, 2068965517, 1200, 1.05, TRUE, '2024-01-01'),
('300347', '医药流通', 'Healthcare', 15.50, 0.024, 7096774194, 1100, 0.92, TRUE, '2024-01-01'),
('300529', '中药制造', 'Healthcare', 28.00, 0.027, 3500000000, 980, 0.98, TRUE, '2024-01-01'),

-- 中小盘医药股
('002773', '医疗服务', 'Healthcare', 42.00, 0.030, 1714285714, 720, 1.08, TRUE, '2024-01-01'),
('688180', '基因测序', 'Healthcare', 95.00, 0.040, 715789474, 680, 1.30, TRUE, '2024-01-01'),
('603392', '保健品', 'Healthcare', 25.00, 0.028, 2320000000, 580, 1.02, TRUE, '2024-01-01'),
('688396', '细胞治疗', 'Healthcare', 120.00, 0.048, 375000000, 450, 1.45, TRUE, '2024-01-01'),

-- ============================================================
-- 工业板块（10只）- 市值占比5%
-- 特征：周期性、中等波动
-- ============================================================

-- 大盘工业股
('601668', '中国建筑', 'Industry', 6.80, 0.025, 66176470588, 4500, 0.88, TRUE, '2024-01-01'),
('600031', '重工集团', 'Industry', 12.50, 0.028, 25600000000, 3200, 0.98, TRUE, '2024-01-01'),
('601919', '高铁装备', 'Industry', 8.50, 0.026, 32941176471, 2800, 0.92, TRUE, '2024-01-01'),

-- 中盘工业股
('600585', '机械制造', 'Industry', 28.00, 0.030, 7857142857, 2200, 1.05, TRUE, '2024-01-01'),
('601766', '航空航天', 'Industry', 35.00, 0.032, 5142857143, 1800, 1.10, TRUE, '2024-01-01'),
('600150', '船舶制造', 'Industry', 18.00, 0.034, 8333333333, 1500, 1.12, TRUE, '2024-01-01'),
('600875', '化工材料', 'Industry', 25.00, 0.035, 4800000000, 1200, 1.15, TRUE, '2024-01-01'),

-- 中小盘工业股
('002202', '工程机械', 'Industry', 22.00, 0.031, 4454545455, 980, 1.07, TRUE, '2024-01-01'),
('603766', '电气设备', 'Industry', 42.00, 0.033, 1714285714, 720, 1.09, TRUE, '2024-01-01'),
('002459', '通用机械', 'Industry', 15.50, 0.032, 4387096774, 680, 1.08, TRUE, '2024-01-01'),

-- ============================================================
-- 地产板块（8只）- 市值占比3%
-- 特征：政策敏感、周期性强
-- ============================================================

('000002', '万科地产', 'RealEstate', 18.50, 0.035, 15135135135, 2800, 1.18, TRUE, '2024-01-01'),
('600048', '保利发展', 'RealEstate', 15.00, 0.033, 14666666667, 2200, 1.15, TRUE, '2024-01-01'),
('001979', '招商蛇口', 'RealEstate', 12.80, 0.032, 11718750000, 1500, 1.12, TRUE, '2024-01-01'),
('600606', '绿地控股', 'RealEstate', 5.60, 0.036, 21428571429, 1200, 1.20, TRUE, '2024-01-01'),
('600340', '华夏幸福', 'RealEstate', 8.80, 0.040, 9659090909, 850, 1.28, TRUE, '2024-01-01'),
('600383', '金地集团', 'RealEstate', 9.50, 0.038, 7157894737, 680, 1.25, TRUE, '2024-01-01'),
('000667', '美好置业', 'RealEstate', 6.20, 0.042, 6774193548, 420, 1.35, TRUE, '2024-01-01'),
('600895', '张江高科', 'RealEstate', 18.00, 0.034, 2111111111, 380, 1.16, TRUE, '2024-01-01'),

-- ============================================================
-- 能源板块（8只）- 市值占比2%
-- 特征：周期性、与大宗商品相关
-- ============================================================

-- 超大盘能源股
('601857', '中国石油', 'Energy', 6.20, 0.028, 137096774194, 8500, 0.95, TRUE, '2024-01-01'),
('600028', '中国石化', 'Energy', 5.80, 0.026, 124137931034, 7200, 0.92, TRUE, '2024-01-01'),
('601088', '中国神华', 'Energy', 28.50, 0.032, 20350877193, 5800, 1.08, TRUE, '2024-01-01'),

-- 中盘能源股
('601225', '陕西煤业', 'Energy', 18.00, 0.035, 12222222222, 2200, 1.15, TRUE, '2024-01-01'),
('600188', '兖矿能源', 'Energy', 22.00, 0.034, 8181818182, 1800, 1.12, TRUE, '2024-01-01'),
('601898', '中煤能源', 'Energy', 8.50, 0.030, 17647058824, 1500, 1.05, TRUE, '2024-01-01'),

-- 中小盘能源股
('600348', '华阳股份', 'Energy', 15.00, 0.036, 4533333333, 680, 1.18, TRUE, '2024-01-01'),
('601699', '潞安环能', 'Energy', 12.50, 0.033, 4160000000, 520, 1.10, TRUE, '2024-01-01'),

-- ============================================================
-- 材料板块（6只）- 市值占比1.5%
-- 特征：周期性、原材料价格敏感
-- ============================================================

('600019', '宝钢股份', 'Materials', 8.50, 0.028, 44705882353, 3800, 1.00, TRUE, '2024-01-01'),
('600309', '万华化学', 'Materials', 95.00, 0.032, 2947368421, 2800, 1.12, TRUE, '2024-01-01'),
('601600', '中国铝业', 'Materials', 5.20, 0.035, 34615384615, 1800, 1.20, TRUE, '2024-01-01'),
('600426', '华鲁恒升', 'Materials', 28.00, 0.030, 4285714286, 1200, 1.08, TRUE, '2024-01-01'),
('000630', '铜陵有色', 'Materials', 3.80, 0.038, 25789473684, 980, 1.28, TRUE, '2024-01-01'),
('600352', '浙江龙盛', 'Materials', 12.50, 0.029, 5440000000, 680, 1.05, TRUE, '2024-01-01'),

-- ============================================================
-- 公用事业板块（5只）- 市值占比0.5%
-- 特征：低波动、低Beta、稳定分红、防御性最强
-- ============================================================

('600900', '长江电力', 'Utilities', 22.50, 0.015, 23111111111, 5200, 0.65, TRUE, '2024-01-01'),
('600011', '华能国际', 'Utilities', 8.50, 0.020, 25882352941, 2200, 0.78, TRUE, '2024-01-01'),
('600886', '国投电力', 'Utilities', 12.00, 0.018, 15000000000, 1800, 0.72, TRUE, '2024-01-01'),
('601985', '中国核电', 'Utilities', 6.80, 0.016, 22058823529, 1500, 0.68, TRUE, '2024-01-01'),
('600027', '华电国际', 'Utilities', 5.50, 0.019, 17818181818, 980, 0.75, TRUE, '2024-01-01'),

-- ============================================================
-- 通信板块（5只）- 市值占比（少量）
-- 特征：稳定、基础设施属性
-- ============================================================

('600941', '中国移动', 'Telecom', 85.00, 0.018, 21176470588, 18000, 0.75, TRUE, '2024-01-01'),
('601728', '中国电信', 'Telecom', 5.50, 0.020, 81818181818, 4500, 0.80, TRUE, '2024-01-01'),
('600050', '中国联通', 'Telecom', 4.20, 0.022, 66666666667, 2800, 0.85, TRUE, '2024-01-01'),
('600764', '中电广通', 'Telecom', 18.00, 0.025, 3777777778, 680, 0.92, TRUE, '2024-01-01'),
('600498', '烽火通信', 'Telecom', 22.00, 0.028, 2363636364, 520, 0.98, TRUE, '2024-01-01')

ON CONFLICT (symbol) DO UPDATE SET
    name = EXCLUDED.name,
    sector = EXCLUDED.sector,
    base_price = EXCLUDED.base_price,
    base_volatility = EXCLUDED.base_volatility,
    outstanding_shares = EXCLUDED.outstanding_shares,
    market_cap = EXCLUDED.market_cap,
    beta = EXCLUDED.beta,
    is_active = EXCLUDED.is_active,
    listing_date = EXCLUDED.listing_date;

-- ============================================================
-- 统计信息
-- ============================================================

-- 查看板块分布
SELECT
    sector AS "板块",
    COUNT(*) AS "股票数量",
    ROUND(SUM(market_cap)::NUMERIC, 0) AS "总市值(亿元)",
    ROUND(AVG(base_volatility)::NUMERIC * 100, 2) || '%' AS "平均波动率",
    ROUND(AVG(beta)::NUMERIC, 2) AS "平均Beta"
FROM stock_metadata
WHERE is_active = TRUE
GROUP BY sector
ORDER BY SUM(market_cap) DESC;

-- 查看市值分布
SELECT
    CASE
        WHEN market_cap >= 5000 THEN '超大盘(>5000亿)'
        WHEN market_cap >= 1000 THEN '大盘(1000-5000亿)'
        WHEN market_cap >= 300 THEN '中盘(300-1000亿)'
        WHEN market_cap >= 100 THEN '小盘(100-300亿)'
        ELSE '微盘(<100亿)'
    END AS "市值分层",
    COUNT(*) AS "股票数量",
    ROUND(SUM(market_cap)::NUMERIC, 0) AS "总市值(亿元)",
    ROUND(AVG(base_price)::NUMERIC, 2) AS "平均股价(元)"
FROM stock_metadata
WHERE is_active = TRUE
GROUP BY
    CASE
        WHEN market_cap >= 5000 THEN '超大盘(>5000亿)'
        WHEN market_cap >= 1000 THEN '大盘(1000-5000亿)'
        WHEN market_cap >= 300 THEN '中盘(300-1000亿)'
        WHEN market_cap >= 100 THEN '小盘(100-300亿)'
        ELSE '微盘(<100亿)'
    END
ORDER BY MIN(market_cap) DESC;

-- 查看Beta系数分布
SELECT
    CASE
        WHEN beta < 0.8 THEN '低Beta(<0.8) - 防御型'
        WHEN beta < 1.0 THEN '中Beta(0.8-1.0) - 稳健型'
        WHEN beta < 1.3 THEN '高Beta(1.0-1.3) - 进攻型'
        ELSE '超高Beta(>1.3) - 激进型'
    END AS "Beta分类",
    COUNT(*) AS "股票数量",
    STRING_AGG(sector, ', ') AS "主要板块"
FROM stock_metadata
WHERE is_active = TRUE
GROUP BY
    CASE
        WHEN beta < 0.8 THEN '低Beta(<0.8) - 防御型'
        WHEN beta < 1.0 THEN '中Beta(0.8-1.0) - 稳健型'
        WHEN beta < 1.3 THEN '高Beta(1.0-1.3) - 进攻型'
        ELSE '超高Beta(>1.3) - 激进型'
    END
ORDER BY MIN(beta);

-- 查看总览
SELECT
    COUNT(*) AS "总股票数",
    ROUND(SUM(market_cap)::NUMERIC, 0) AS "总市值(亿元)",
    ROUND(AVG(base_price)::NUMERIC, 2) AS "平均股价(元)",
    ROUND(AVG(base_volatility)::NUMERIC * 100, 2) || '%' AS "平均波动率",
    ROUND(AVG(beta)::NUMERIC, 2) AS "平均Beta"
FROM stock_metadata
WHERE is_active = TRUE;

-- ============================================================
-- 完成提示
-- ============================================================

DO $$
BEGIN
    RAISE NOTICE '============================================================';
    RAISE NOTICE 'A股虚拟市场初始化完成！';
    RAISE NOTICE '- 总股票数：106只';
    RAISE NOTICE '- 覆盖板块：10大行业';
    RAISE NOTICE '- 市值范围：380亿 - 22000亿';
    RAISE NOTICE '- Beta范围：0.65 - 1.80';
    RAISE NOTICE '============================================================';
END $$;
