# happyStock 功能清单

> 记录项目的已完成功能和后续开发规划

## 🎯 核心开发策略

**当前阶段重点：打造功能强大的专业级K线图表工具**

### 战略定位
- 🔥 **主攻方向**：专业图表工具（对标 TradingView）
- 📊 **技术指标库**：完善常用和高级技术指标（50+指标）
- 🎨 **绘图工具**：丰富的图表标注和分析工具
- ⚙️ **用户体验**：流畅的交互、个性化配置、快捷键支持
- 📉 **多图表布局**：支持多窗口、多子图专业分析

### 暂缓内容
- ⏸️ 实时数据推送（使用模拟数据即可验证图表功能）
- ⏸️ 多数据源对接（聚宽、Tushare 等）
- ⏸️ 多市场支持（先专注A股模拟）
- ⏸️ 复杂的社交功能（策略分享、跟单等）

### 开发理念
1. **先工具后数据**：图表功能完善后再对接真实数据源
2. **模拟数据足够**：用模拟数据就能展示所有图表能力
3. **MVP 快速迭代**：每个指标/工具独立开发，快速上线验证
4. **用户体验优先**：流畅度、易用性比功能数量更重要

---

## ✅ 已完成功能

### 基础架构
- [x] Next.js 15.4 + React 19 前端架构
- [x] FastAPI + Python 3.13 后端架构
- [x] SQLite 数据库配置
- [x] 项目启动脚本（Windows/Linux/Mac）
- [x] 开发环境配置

### 用户系统
- [x] 用户注册/登录 API
- [x] 用户个人资料管理
- [x] 模拟账户系统

### 模拟交易系统
- [x] 交易引擎（买入/卖出）
- [x] 持仓管理
- [x] 交易历史记录
- [x] 资金精确计算（Decimal）
- [x] 数据库事务保证

### 图表系统
- [x] Lightweight Charts 集成
- [x] K线图表显示
- [x] 多时间周期切换（5m/15m/30m/60m/120m/日/周/月）
- [x] 成交量柱状图
- [x] 图表缩放和平移
- [x] EMA 技术指标（5/10/20/30/60/120周期）
- [x] EMA 配置面板（快速预设 + 自定义）

### 数据接口
- [x] K线数据 API
- [x] 股票搜索 API
- [x] 资产列表 API
- [x] 模拟K线数据生成

---

## 🚧 后续功能规划

### 1. 技术指标系统扩展

#### 1.1 趋势类指标
- [ ] **MA（简单移动平均线）**
  - 支持多周期 MA（5/10/20/30/60/120/250）
  - 颜色配置和线型设置
  - 与 EMA 共用配置面板

- [ ] **MACD（指数平滑异同移动平均线）**
  - 独立子图面板
  - DIFF 线（快线 EMA12 - 慢线 EMA26）
  - DEA 线（DIFF 的 9 日 EMA）
  - MACD 柱状图（DIFF - DEA）× 2
  - 金叉/死叉信号标注

- [ ] **布林带（Bollinger Bands）**
  - 主图叠加显示
  - 上轨（MA + 2×标准差）
  - 中轨（MA）
  - 下轨（MA - 2×标准差）
  - 支持周期和标准差倍数调整

- [ ] **SAR（抛物线指标）**
  - 主图叠加圆点显示
  - 多空转换信号

- [ ] **一目均衡图（Ichimoku）**
  - 转换线、基准线
  - 先行带A、先行带B
  - 延迟线

#### 1.2 震荡类指标
- [ ] **RSI（相对强弱指标）**
  - 独立子图面板
  - RSI 曲线（默认 14 周期）
  - 超买线（70）和超卖线（30）
  - 多周期 RSI 叠加

- [ ] **KDJ 指标**
  - 独立子图面板
  - K 线（快线）
  - D 线（慢线）
  - J 线（方向线）
  - 超买超卖区间标注

- [ ] **STOCH（随机指标）**
  - %K 和 %D 线
  - 超买超卖水平线

- [ ] **CCI（顺势指标）**
  - CCI 曲线
  - ±100 水平线

- [ ] **威廉指标（Williams %R）**
  - %R 曲线
  - 超买超卖区间

#### 1.3 成交量指标
- [ ] **成交量增强**
  - VOL-MA（成交量移动平均线）
  - 放量/缩量颜色标识

- [ ] **OBV（能量潮指标）**
  - 独立子图
  - OBV 累积曲线
  - OBV-MA 叠加

- [ ] **VWAP（成交量加权平均价）**
  - 主图叠加
  - 实时 VWAP 计算

#### 1.4 高级指标
- [ ] **ATR（真实波幅）**
  - 独立子图
  - 波动率分析

- [ ] **DMI（趋向指标）**
  - +DI、-DI、ADX、ADXR
  - 趋势强度判断

- [ ] **BIAS（乖离率）**
  - 多周期 BIAS
  - 超买超卖判断

---

### 2. 图表功能增强

#### 2.1 图表类型
- [ ] **美国线（OHLC）**
  - 开高低收柱状图
  - 切换按钮

- [ ] **山峰图（Area Chart）**
  - 收盘价填充图
  - 渐变色效果

- [ ] **Heiken Ashi 蜡烛图**
  - 平滑蜡烛图
  - 过滤噪音

- [ ] **线形图**
  - 简洁的收盘价连线

- [ ] **Renko 砖形图**
  - 过滤时间因素
  - 只看价格变化

#### 2.2 绘图工具
- [ ] **基础绘图**
  - 趋势线（支持延长线）
  - 水平线（支撑/阻力位）
  - 垂直线（重要时间点）
  - 射线

- [ ] **几何图形**
  - 矩形
  - 圆形/椭圆
  - 三角形
  - 平行通道

- [ ] **斐波那契工具**
  - 斐波那契回撤
  - 斐波那契扩展
  - 斐波那契扇形
  - 斐波那契时间线

- [ ] **文字标注**
  - 文本标签
  - 价格标签
  - 箭头标注
  - 图标标记

- [ ] **绘图管理**
  - 绘图列表
  - 显示/隐藏
  - 锁定/解锁
  - 复制/删除

#### 2.3 多图表布局
- [ ] **布局管理**
  - 1×1、2×1、2×2 布局
  - 最多 8 个图表窗口
  - 拖拽调整大小
  - 布局预设保存

- [ ] **图表同步**
  - 时间轴同步
  - 十字光标同步
  - 缩放同步

#### 2.4 图表设置
- [ ] **主题自定义**
  - 深色/浅色主题切换
  - 颜色方案自定义
  - 字体大小调整

- [ ] **显示设置**
  - 网格线开关
  - 十字光标样式
  - 价格刻度位置
  - 时间刻度格式

- [ ] **图表快照**
  - 截图保存
  - 社交分享
  - 水印设置

---

### 3. 实时数据推送

#### 3.1 WebSocket 集成
- [ ] **后端 WebSocket 服务**
  - FastAPI WebSocket 端点
  - 连接管理（心跳、重连）
  - 订阅管理（股票订阅/取消）

- [ ] **前端 WebSocket 客户端**
  - 自动重连机制
  - 消息队列处理
  - 错误处理和降级

- [ ] **实时数据类型**
  - 实时K线更新
  - 实时价格推送
  - 实时成交量
  - 实时买卖盘口

#### 3.2 数据刷新策略
- [ ] **智能刷新**
  - 分钟级K线自动刷新
  - 盘中数据实时更新
  - 收盘后停止推送

- [ ] **数据缓存**
  - Redis 缓存历史数据
  - 本地 IndexedDB 缓存
  - 缓存失效策略

---

### 4. 交易功能完善

#### 4.1 高级订单类型
- [ ] **限价单**
  - 设置买入/卖出价格
  - 价格到达自动成交

- [ ] **止损单**
  - 设置止损价
  - 亏损保护

- [ ] **止盈单**
  - 设置止盈价
  - 利润锁定

- [ ] **追踪止损**
  - 动态调整止损价
  - 跟随最高价移动

- [ ] **条件单**
  - 技术指标条件触发
  - 价格突破条件
  - 成交量条件

#### 4.2 交易成本计算
- [ ] **手续费系统**
  - 可配置的佣金费率
  - 最低佣金设置
  - 印花税（A股）
  - 过户费（A股）

- [ ] **成本统计**
  - 持仓成本价
  - 交易总成本
  - 手续费占比分析

#### 4.3 风险管理
- [ ] **仓位管理**
  - 持仓比例显示
  - 仓位预警
  - 建议仓位计算

- [ ] **风险指标**
  - 风险收益比
  - 最大回撤
  - 夏普比率
  - 胜率统计

- [ ] **风险提醒**
  - 亏损预警
  - 重仓提醒
  - 连续亏损提醒

#### 4.4 交易面板增强
- [ ] **快速交易**
  - 一键买入/卖出
  - 快捷键交易
  - 批量下单

- [ ] **委托管理**
  - 未成交委托列表
  - 撤单功能
  - 改单功能

- [ ] **持仓详情**
  - 持仓盈亏实时更新
  - 持仓成本分析
  - 持仓分布饼图

---

### 5. AI 功能集成

#### 5.1 AI 交易建议
- [ ] **技术分析 AI**
  - 基于多指标综合判断
  - 买入/卖出信号生成
  - 信号强度评分

- [ ] **趋势判断**
  - 上升/下降/盘整识别
  - 趋势强度评估
  - 趋势转折预警

- [ ] **支撑阻力识别**
  - 自动识别关键价位
  - 突破概率预测
  - 价格目标位

#### 5.2 智能止损止盈
- [ ] **动态止损**
  - 基于 ATR 的止损位
  - 移动止损策略
  - 时间止损

- [ ] **智能止盈**
  - 分批止盈策略
  - 基于波动率的止盈
  - 目标位自动调整

#### 5.3 市场情绪分析
- [ ] **新闻情绪**
  - 新闻抓取和分析
  - 情绪指数计算
  - 重大事件提醒

- [ ] **社区情绪**
  - 用户讨论热度
  - 看多/看空比例
  - 情绪指标可视化

#### 5.4 AI 对话助手
- [ ] **智能问答**
  - 股票基本面查询
  - 技术指标解释
  - 交易策略咨询

- [ ] **语音交互**
  - 语音查询股票
  - 语音下单
  - 语音播报行情

---

### 6. 回测系统

#### 6.1 策略回测引擎
- [ ] **回测框架**
  - 历史数据回测
  - 逐笔回测模式
  - 快速回测模式

- [ ] **策略编辑器**
  - 可视化策略构建
  - Pine Script 支持
  - Python 策略支持

- [ ] **策略库**
  - 预置经典策略
  - 用户自定义策略
  - 策略分享和导入

#### 6.2 回测结果分析
- [ ] **性能指标**
  - 总收益率
  - 年化收益率
  - 夏普比率
  - 最大回撤
  - 胜率/赔率
  - 盈亏比

- [ ] **可视化报告**
  - 资金曲线
  - 回撤曲线
  - 交易分布
  - 月度/年度收益表

- [ ] **交易明细**
  - 每笔交易记录
  - 持仓时长统计
  - 盈亏分析

#### 6.3 策略优化
- [ ] **参数优化**
  - 网格搜索
  - 遗传算法优化
  - 参数敏感度分析

- [ ] **过拟合检测**
  - 样本内外对比
  - 滚动回测
  - 稳健性测试

---

### 7. 社交功能增强

#### 7.1 策略分享
- [ ] **策略发布**
  - 策略描述和参数
  - 回测结果展示
  - 策略标签分类

- [ ] **策略互动**
  - 点赞和收藏
  - 评论和讨论
  - 策略排行榜

- [ ] **策略市场**
  - 免费/付费策略
  - 策略订阅
  - 策略租赁

#### 7.2 跟单功能
- [ ] **跟单系统**
  - 关注交易高手
  - 自动跟单设置
  - 跟单比例控制

- [ ] **跟单统计**
  - 跟单收益
  - 跟单成功率
  - 跟单手续费

- [ ] **跟单排行**
  - 收益率排名
  - 粉丝数排名
  - 交易胜率排名

#### 7.3 社区互动
- [ ] **动态广场**
  - 用户交易动态
  - 热门讨论
  - 实时评论

- [ ] **交易想法**
  - 图文分析发布
  - 技术分析分享
  - 标注和截图

- [ ] **问答社区**
  - 投资问题提问
  - 专家回答
  - 最佳答案评选

- [ ] **直播功能**
  - 盘中直播解盘
  - 教学视频直播
  - 弹幕互动

---

### 8. 用户体验优化

#### 8.1 个性化设置
- [ ] **图表偏好**
  - 颜色主题保存
  - 指标组合保存
  - 布局保存和恢复

- [ ] **快捷键**
  - 自定义快捷键
  - 快捷键帮助文档
  - 常用操作快捷键

- [ ] **自选股管理**
  - 自选股列表
  - 分组管理
  - 批量导入导出

#### 8.2 移动端适配
- [ ] **响应式布局**
  - 移动端图表适配
  - 触摸手势支持
  - 横屏/竖屏切换

- [ ] **移动端专属UI**
  - 简化版交易面板
  - 移动端指标配置
  - 手势绘图工具

- [ ] **App 化**
  - PWA 支持
  - 原生 App（React Native）
  - 推送通知

#### 8.3 性能优化
- [ ] **渲染优化**
  - WebGL 渲染加速
  - 虚拟滚动
  - 懒加载

- [ ] **数据优化**
  - 数据分页加载
  - 增量数据更新
  - 数据压缩传输

- [ ] **缓存策略**
  - Service Worker 缓存
  - CDN 加速
  - 静态资源优化

#### 8.4 无障碍访问
- [ ] **辅助功能**
  - 键盘导航
  - 屏幕阅读器支持
  - 高对比度模式

- [ ] **国际化**
  - 多语言支持（中/英）
  - 时区处理
  - 货币格式

---

### 9. 数据源集成

#### 9.1 国内数据源
- [ ] **聚宽数据**
  - A股实时行情
  - 历史K线数据
  - 财务数据

- [ ] **Tushare**
  - 免费数据接口
  - A股/港股数据
  - 指数数据

- [ ] **东方财富**
  - 实时行情
  - F10 资料
  - 新闻资讯

#### 9.2 国际数据源
- [ ] **Yahoo Finance**
  - 美股数据
  - 外汇数据
  - 商品期货

- [ ] **Alpha Vantage**
  - 股票数据 API
  - 技术指标数据
  - 基本面数据

- [ ] **Binance API**
  - 加密货币行情
  - 交易对数据
  - 历史数据

#### 9.3 多市场支持
- [ ] **A股市场**
  - 上交所
  - 深交所
  - 科创板/创业板

- [ ] **港股市场**
  - 港交所
  - AH 股对比
  - 港股通

- [ ] **美股市场**
  - NYSE
  - NASDAQ
  - 盘前盘后

- [ ] **加密货币**
  - 主流币种
  - 交易所对接
  - DeFi 数据

---

### 10. 系统功能

#### 10.1 通知系统
- [ ] **价格提醒**
  - 目标价到达通知
  - 涨跌幅提醒
  - 突破提醒

- [ ] **指标信号**
  - 金叉/死叉提醒
  - 超买超卖提醒
  - 背离提醒

- [ ] **持仓提醒**
  - 盈亏提醒
  - 止损触发
  - 止盈触发

- [ ] **通知方式**
  - 站内消息
  - 邮件通知
  - 微信/钉钉推送
  - 短信通知

#### 10.2 数据导出
- [ ] **交易记录导出**
  - Excel 格式
  - CSV 格式
  - PDF 报告

- [ ] **持仓数据导出**
  - 持仓快照
  - 历史持仓
  - 盈亏分析

- [ ] **图表导出**
  - PNG/JPG 图片
  - 高清截图
  - 带水印分享

#### 10.3 用户权限
- [ ] **会员体系**
  - 免费版（基础功能）
  - 高级版（更多指标）
  - 专业版（全功能）

- [ ] **功能限制**
  - API 调用频率
  - 数据刷新频率
  - 指标数量限制
  - 自选股数量

- [ ] **VIP 特权**
  - 实时数据推送
  - AI 功能优先
  - 客服优先响应
  - 专属标识

#### 10.4 安全功能
- [ ] **账户安全**
  - 两步验证
  - 登录日志
  - 异常登录提醒

- [ ] **交易安全**
  - 交易密码
  - 资金密码
  - 操作日志

- [ ] **数据安全**
  - 数据加密
  - 定期备份
  - 容灾恢复

---

## 🎯 优先级分类

> **核心策略：重点打造功能强大的专业级K线图表工具，暂缓真实数据接入**

### P0 - 最高优先级：核心图表功能（本周完成）
1. ✅ **EMA 指标**（已完成）
2. ✅ **MACD 指标**（已完成 - 独立子图，最常用的趋势指标）
3. 🔥 **K线倒计时功能**（NEW - 每根K线显示倒计时，实时刷新，与K线对齐）
4. 🔥 **动态数据加载优化**（NEW - 左右滑动/缩放时根据时间范围智能加载数据，性能优化）
5. 🔥 **线形图（Line Chart）**（图表类型扩展，简洁的收盘价连线）

### P1 - 高优先级：图表核心功能（1-2周完成）
6. **RSI 指标**（独立子图，超买超卖判断）
7. **KDJ 指标**（独立子图，适合中国市场）
8. **布林带指标**（主图叠加，波动率分析）
9. **MA 指标**（主图叠加，与 EMA 互补）
10. **绘图工具基础版**（趋势线、水平线、矩形）

### P2 - 中优先级：图表增强功能（2-4周完成）
11. **成交量指标增强**（VOL-MA 叠加）
12. **图表类型扩展**（美国线、山峰图、Heiken Ashi）
13. **OBV 指标**（独立子图，量价分析）
14. **ATR 指标**（独立子图，波动率）
15. **绘图工具进阶**（斐波那契、平行通道、文字标注）
16. **多子图布局**（支持最多 4 个子图）
17. **图表设置保存**（指标组合、颜色主题）
18. **技术指标管理器**（指标列表、添加/删除/排序）

### P2 - 中优先级：交易功能完善（1-2个月完成）
16. **高级订单类型**（止损/止盈/条件单）
17. **交易手续费计算**（佣金、印花税、过户费）
18. **风险管理工具**（仓位管理、风险指标）
19. **自选股管理**（分组、批量操作）
20. **交易面板增强**（快速交易、委托管理）

### P3 - 低优先级：高级图表功能（2-3个月完成）
21. **高级技术指标**（DMI、CCI、威廉指标、一目均衡图）
22. **多图表布局**（2×2、自定义布局）
23. **图表同步**（时间轴、十字光标、缩放同步）
24. **绘图管理**（绘图列表、锁定、复制）
25. **图表快照分享**（截图、水印、社交分享）
26. **快捷键系统**（自定义快捷键）

### P4 - 低优先级：AI 和回测（3个月+）
27. **AI 交易建议**（基于技术指标的买卖信号）
28. **回测系统基础版**（策略回测、性能分析）
29. **策略编辑器**（可视化策略构建）
30. **智能止损止盈**（动态止损建议）

### P5 - 长期规划：数据和生态（6个月+）
31. **实时数据 WebSocket 推送**（暂缓）
32. **多数据源集成**（聚宽、Tushare等，暂缓）
33. **多市场支持**（港股、美股，暂缓）
34. **社交功能增强**（策略分享、跟单）
35. **移动端适配**（响应式、PWA）
36. **会员体系和商业化**
37. **国际化支持**
38. **原生 App 开发**

---

## 📝 开发建议

1. **迭代开发**：每个功能模块独立开发和测试，完成一个上线一个
2. **用户反馈**：根据用户反馈调整优先级，数据驱动决策
3. **性能优先**：每个新功能都要考虑性能影响，避免过度优化
4. **代码复用**：技术指标采用统一的计算框架和展示组件
5. **文档同步**：每个功能完成后更新文档和用户手册

---

*最后更新：2025-10-27*
