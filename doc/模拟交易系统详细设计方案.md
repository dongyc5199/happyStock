# æ¨¡æ‹Ÿäº¤æ˜“ç³»ç»Ÿè¯¦ç»†è®¾è®¡æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-23
> **ç›®æ ‡é˜¶æ®µ**: MVP Phase - Week 7-8
> **é¢„è®¡å¼€å‘å‘¨æœŸ**: 2å‘¨

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ•°æ®åº“è®¾è®¡](#3-æ•°æ®åº“è®¾è®¡)
4. [åç«¯APIè®¾è®¡](#4-åç«¯apiè®¾è®¡)
5. [å‰ç«¯ç•Œé¢è®¾è®¡](#5-å‰ç«¯ç•Œé¢è®¾è®¡)
6. [äº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘](#6-äº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘)
7. [æŠ€æœ¯é€‰å‹](#7-æŠ€æœ¯é€‰å‹)
8. [å¼€å‘è®¡åˆ’](#8-å¼€å‘è®¡åˆ’)
9. [æµ‹è¯•æ–¹æ¡ˆ](#9-æµ‹è¯•æ–¹æ¡ˆ)
10. [é£é™©æ§åˆ¶](#10-é£é™©æ§åˆ¶)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 åŠŸèƒ½å®šä½

æ¨¡æ‹Ÿäº¤æ˜“ç³»ç»Ÿæ˜¯ happyStock å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œæä¾›é›¶é£é™©çš„è‚¡ç¥¨äº¤æ˜“æ¨¡æ‹Ÿç¯å¢ƒï¼Œå¸®åŠ©ç”¨æˆ·å­¦ä¹ æŠ•èµ„æŠ€èƒ½ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

- âœ… **è´¦æˆ·ç®¡ç†**: åˆ›å»ºã€æŸ¥è¯¢ã€é‡ç½®æ¨¡æ‹Ÿè´¦æˆ·
- âœ… **äº¤æ˜“æ‰§è¡Œ**: ä¹°å…¥/å–å‡ºè‚¡ç¥¨ï¼ˆåŸºäºå®æ—¶æˆ–å»¶æ—¶è¡Œæƒ…ï¼‰
- âœ… **æŒä»“ç®¡ç†**: æŸ¥è¯¢æŒä»“ã€è®¡ç®—ç›ˆäºã€æŒä»“åˆ†æ
- âœ… **äº¤æ˜“è®°å½•**: å®Œæ•´çš„äº¤æ˜“å†å²è®°å½•å’ŒæŸ¥è¯¢
- âœ… **èµ„äº§æ•°æ®**: è‚¡ç¥¨åˆ—è¡¨ã€å®æ—¶ä»·æ ¼ã€åŸºç¡€ä¿¡æ¯
- âœ… **é£é™©æ§åˆ¶**: èµ„é‡‘å……è¶³æ€§éªŒè¯ã€æŒä»“æ•°é‡éªŒè¯

### 1.3 MVP èŒƒå›´ç•Œå®š

**åŒ…å«åŠŸèƒ½**:
- æ¨¡æ‹Ÿè´¦æˆ·çš„ CRUD æ“ä½œ
- åŸºç¡€ä¹°å…¥/å–å‡ºäº¤æ˜“
- æŒä»“æŸ¥è¯¢å’Œç›ˆäºè®¡ç®—
- äº¤æ˜“å†å²è®°å½•
- ç®€å•çš„å‰ç«¯äº¤æ˜“ç•Œé¢

**ä¸åŒ…å«åŠŸèƒ½** (åç»­è¿­ä»£):
- é™ä»·å•ã€æ­¢æŸå•ç­‰é«˜çº§è®¢å•ç±»å‹
- èèµ„èåˆ¸
- AI æ™ºèƒ½æ¨è
- å›æµ‹åŠŸèƒ½
- å¤æ‚çš„å›¾è¡¨åˆ†æ

### 1.4 æˆåŠŸæŒ‡æ ‡

- **åŠŸèƒ½å®Œæ•´æ€§**: æ ¸å¿ƒäº¤æ˜“æµç¨‹ç«¯åˆ°ç«¯å¯ç”¨
- **æ€§èƒ½æŒ‡æ ‡**:
  - äº¤æ˜“å“åº”æ—¶é—´ < 500ms
  - æŒä»“æŸ¥è¯¢ < 200ms
  - æ”¯æŒå•è´¦æˆ· 100+ æŒä»“
- **å‡†ç¡®æ€§**: èµ„é‡‘å’ŒæŒä»“è®¡ç®— 100% å‡†ç¡®ï¼Œæ— ç²¾åº¦æŸå¤±
- **å¯ç”¨æ€§**: ç³»ç»Ÿå¯ç”¨æ€§ > 99%

---

## 2. æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (Next.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  äº¤æ˜“é¡µé¢    â”‚  â”‚  æŒä»“é¡µé¢    â”‚  â”‚  å†å²è®°å½•    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                 â”‚                 â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                         â”‚ REST API                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (FastAPI)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   API Layer (è·¯ç”±)                    â”‚    â”‚
â”‚  â”‚  /accounts  /trades  /holdings  /assets              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Business Logic Layer (æœåŠ¡å±‚)            â”‚    â”‚
â”‚  â”‚  AccountService  TradeService  HoldingService        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 Trading Engine (äº¤æ˜“å¼•æ“)             â”‚    â”‚
â”‚  â”‚  - è®¢å•éªŒè¯  - äº¤æ˜“æ’®åˆ  - æŒä»“æ›´æ–°  - ä½™é¢è®¡ç®—      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Data Access Layer (æ•°æ®è®¿é—®å±‚)           â”‚    â”‚
â”‚  â”‚  ORM Models (Tortoise-ORM / SQLAlchemy)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (PostgreSQL + Redis)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚      Redis       â”‚                    â”‚
â”‚  â”‚  - users        â”‚  â”‚  - ä»·æ ¼ç¼“å­˜      â”‚                    â”‚
â”‚  â”‚  - sim_accounts â”‚  â”‚  - ä¼šè¯æ•°æ®      â”‚                    â”‚
â”‚  â”‚  - sim_trades   â”‚  â”‚  - å®æ—¶è¡Œæƒ…      â”‚                    â”‚
â”‚  â”‚  - sim_holdings â”‚  â”‚                  â”‚                    â”‚
â”‚  â”‚  - assets       â”‚  â”‚                  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Services (å¤–éƒ¨æœåŠ¡)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  è¡Œæƒ…æ•°æ® API   â”‚  â”‚   AI æœåŠ¡(æœªæ¥)  â”‚                    â”‚
â”‚  â”‚  - æ–°æµªè´¢ç»     â”‚  â”‚  - Claude API    â”‚                    â”‚
â”‚  â”‚  - ä¸œæ–¹è´¢å¯Œ     â”‚  â”‚  - äº¤æ˜“å»ºè®®      â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ¶æ„åˆ†å±‚

| å±‚çº§ | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **è¡¨ç°å±‚** | ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ | Next.js 15, React 19, Tailwind CSS |
| **APIå±‚** | è·¯ç”±ã€è¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ | FastAPI, Pydantic |
| **ä¸šåŠ¡é€»è¾‘å±‚** | ä¸šåŠ¡è§„åˆ™ã€æµç¨‹æ§åˆ¶ | Python Services |
| **äº¤æ˜“å¼•æ“å±‚** | æ ¸å¿ƒäº¤æ˜“é€»è¾‘ã€è®¡ç®— | Python Classes |
| **æ•°æ®è®¿é—®å±‚** | ORMã€æ•°æ®åº“æ“ä½œ | Tortoise-ORM / SQLAlchemy |
| **æ•°æ®å­˜å‚¨å±‚** | æŒä¹…åŒ–å­˜å‚¨ | PostgreSQL, Redis |
| **å¤–éƒ¨æœåŠ¡å±‚** | ç¬¬ä¸‰æ–¹ API é›†æˆ | HTTP Client, WebSocket |

### 2.3 æ•°æ®æµè®¾è®¡

#### ä¹°å…¥äº¤æ˜“æµç¨‹
```
ç”¨æˆ· â†’ å‰ç«¯è¡¨å• â†’ APIè¯·æ±‚ â†’ å‚æ•°éªŒè¯
  â†’ äº¤æ˜“å¼•æ“:
     1. æŸ¥è¯¢è´¦æˆ·ä½™é¢
     2. è·å–å®æ—¶ä»·æ ¼
     3. è®¡ç®—äº¤æ˜“é‡‘é¢
     4. éªŒè¯èµ„é‡‘å……è¶³æ€§
     5. æ‰£å‡è´¦æˆ·ä½™é¢
     6. åˆ›å»ºäº¤æ˜“è®°å½•
     7. æ›´æ–°/åˆ›å»ºæŒä»“è®°å½•
     8. è¿”å›äº¤æ˜“ç»“æœ
  â†’ å‰ç«¯æ›´æ–°UI â†’ ç”¨æˆ·åé¦ˆ
```

#### å–å‡ºäº¤æ˜“æµç¨‹
```
ç”¨æˆ· â†’ å‰ç«¯è¡¨å• â†’ APIè¯·æ±‚ â†’ å‚æ•°éªŒè¯
  â†’ äº¤æ˜“å¼•æ“:
     1. æŸ¥è¯¢æŒä»“æ•°é‡
     2. è·å–å®æ—¶ä»·æ ¼
     3. éªŒè¯æŒä»“å……è¶³æ€§
     4. è®¡ç®—å–å‡ºé‡‘é¢
     5. å¢åŠ è´¦æˆ·ä½™é¢
     6. åˆ›å»ºäº¤æ˜“è®°å½•
     7. å‡å°‘æŒä»“æ•°é‡
     8. è¿”å›äº¤æ˜“ç»“æœ
  â†’ å‰ç«¯æ›´æ–°UI â†’ ç”¨æˆ·åé¦ˆ
```

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 ER å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚
â”‚  (ç”¨æˆ·è¡¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   sim_accounts    â”‚
â”‚  (æ¨¡æ‹Ÿè´¦æˆ·è¡¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
       â”‚ N           â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  sim_trades   â”‚   â”‚
â”‚ (äº¤æ˜“è®°å½•è¡¨)  â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ sim_holdings  â”‚
              â”‚ (æŒä»“è¡¨)      â”‚
              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ N
                    â”‚
                    â”‚ 1
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
              â”‚  assets   â”‚
              â”‚ (èµ„äº§è¡¨)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒè¡¨ç»“æ„ (å·²å®ç°)

è¯¦è§ `sql_scripts/create_user_table.sql`

**å…³é”®çº¦æŸå’Œç´¢å¼•å»ºè®®**:

```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
CREATE INDEX idx_sim_accounts_user_id ON sim_accounts(user_id);
CREATE INDEX idx_sim_trades_account_id ON sim_trades(account_id);
CREATE INDEX idx_sim_trades_asset_id ON sim_trades(asset_id);
CREATE INDEX idx_sim_trades_trade_time ON sim_trades(trade_time DESC);
CREATE INDEX idx_sim_holdings_account_id ON sim_holdings(account_id);
CREATE INDEX idx_assets_symbol ON assets(symbol);
CREATE INDEX idx_assets_asset_type ON assets(asset_type);
```

### 3.3 æ•°æ®å®Œæ•´æ€§è§„åˆ™

1. **è´¦æˆ·ä½™é¢ä¸€è‡´æ€§**: `current_balance >= 0`
2. **æŒä»“æ•°é‡ä¸€è‡´æ€§**: `quantity > 0` (å–å®Œè‡ªåŠ¨åˆ é™¤è®°å½•)
3. **äº¤æ˜“é‡‘é¢ç²¾åº¦**: ä½¿ç”¨ DECIMAL(18,2) é¿å…æµ®ç‚¹æ•°è¯¯å·®
4. **çº§è”åˆ é™¤**: ç”¨æˆ·åˆ é™¤ â†’ è´¦æˆ·åˆ é™¤ â†’ äº¤æ˜“è®°å½•åˆ é™¤ + æŒä»“åˆ é™¤

---

## 4. åç«¯APIè®¾è®¡

### 4.1 API åŸºç¡€è§„èŒƒ

- **Base URL**: `http://localhost:8000/api/v1`
- **è®¤è¯æ–¹å¼**: JWT Bearer Token (éœ€è¦å…ˆå®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ)
- **å“åº”æ ¼å¼**: JSON
- **HTTP çŠ¶æ€ç **:
  - 200: æˆåŠŸ
  - 201: åˆ›å»ºæˆåŠŸ
  - 400: è¯·æ±‚å‚æ•°é”™è¯¯
  - 401: æœªæˆæƒ
  - 404: èµ„æºä¸å­˜åœ¨
  - 500: æœåŠ¡å™¨é”™è¯¯

### 4.2 ç»Ÿä¸€å“åº”ç»“æ„

```json
// æˆåŠŸå“åº”
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}

// é”™è¯¯å“åº”
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_BALANCE",
    "message": "è´¦æˆ·ä½™é¢ä¸è¶³",
    "details": { ... }
  }
}
```

### 4.3 API æ¥å£è¯¦ç»†è®¾è®¡

#### 4.3.1 è´¦æˆ·ç®¡ç† API

##### POST /api/v1/accounts
**åŠŸèƒ½**: åˆ›å»ºæ¨¡æ‹Ÿè´¦æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "account_name": "æˆ‘çš„ç¬¬ä¸€ä¸ªè´¦æˆ·",
  "initial_balance": 100000.00
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "user_id": 1,
    "account_name": "æˆ‘çš„ç¬¬ä¸€ä¸ªè´¦æˆ·",
    "initial_balance": 100000.00,
    "current_balance": 100000.00,
    "created_at": "2025-10-23T10:00:00Z"
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
- é»˜è®¤åˆå§‹èµ„é‡‘: Â¥100,000
- å•ä¸ªç”¨æˆ·æœ€å¤šåˆ›å»º 3 ä¸ªè´¦æˆ·
- è´¦æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼Œæœ€é•¿ 100 å­—ç¬¦

---

##### GET /api/v1/accounts/{account_id}
**åŠŸèƒ½**: è·å–è´¦æˆ·è¯¦æƒ…

**è·¯å¾„å‚æ•°**:
- `account_id`: è´¦æˆ· ID

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "user_id": 1,
    "account_name": "æˆ‘çš„ç¬¬ä¸€ä¸ªè´¦æˆ·",
    "initial_balance": 100000.00,
    "current_balance": 85000.00,
    "total_assets": 125000.00,
    "total_profit": 10000.00,
    "profit_rate": 10.0,
    "created_at": "2025-10-23T10:00:00Z"
  }
}
```

**è®¡ç®—é€»è¾‘**:
- `total_assets` = `current_balance` + æ‰€æœ‰æŒä»“å¸‚å€¼
- `total_profit` = `total_assets` - `initial_balance`
- `profit_rate` = (`total_profit` / `initial_balance`) * 100

---

##### GET /api/v1/accounts/user/{user_id}
**åŠŸèƒ½**: è·å–ç”¨æˆ·çš„æ‰€æœ‰è´¦æˆ·

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤: 1)
- `page_size`: æ¯é¡µæ•°é‡ (é»˜è®¤: 10)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "accounts": [ ... ],
    "total": 2,
    "page": 1,
    "page_size": 10
  }
}
```

---

##### PUT /api/v1/accounts/{account_id}/reset
**åŠŸèƒ½**: é‡ç½®è´¦æˆ· (æ¸…ç©ºæŒä»“å’Œäº¤æ˜“è®°å½•ï¼Œæ¢å¤åˆå§‹èµ„é‡‘)

**å“åº”**:
```json
{
  "success": true,
  "message": "è´¦æˆ·å·²é‡ç½®",
  "data": {
    "id": 1,
    "current_balance": 100000.00
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
- åˆ é™¤è¯¥è´¦æˆ·æ‰€æœ‰æŒä»“è®°å½•
- åˆ é™¤è¯¥è´¦æˆ·æ‰€æœ‰äº¤æ˜“è®°å½•
- é‡ç½®ä½™é¢ä¸ºåˆå§‹èµ„é‡‘

---

#### 4.3.2 äº¤æ˜“æ‰§è¡Œ API

##### POST /api/v1/trades/buy
**åŠŸèƒ½**: ä¹°å…¥äº¤æ˜“

**è¯·æ±‚ä½“**:
```json
{
  "account_id": 1,
  "asset_symbol": "600000",
  "quantity": 100,
  "price": 12.50
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "trade_id": 1001,
    "account_id": 1,
    "asset_id": 5,
    "asset_symbol": "600000",
    "asset_name": "æµ¦å‘é“¶è¡Œ",
    "trade_type": "BUY",
    "quantity": 100,
    "price": 12.50,
    "total_amount": 1250.00,
    "trade_time": "2025-10-23T14:30:00Z",
    "account_balance_after": 98750.00
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
1. éªŒè¯è´¦æˆ·å­˜åœ¨
2. éªŒè¯èµ„äº§å­˜åœ¨
3. è®¡ç®—äº¤æ˜“é‡‘é¢: `total_amount = quantity * price`
4. éªŒè¯ä½™é¢å……è¶³: `current_balance >= total_amount`
5. æ‰£å‡ä½™é¢
6. åˆ›å»ºäº¤æ˜“è®°å½•
7. æ›´æ–°æˆ–åˆ›å»ºæŒä»“è®°å½•

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_BALANCE",
    "message": "è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢: Â¥1000.00, éœ€è¦: Â¥1250.00"
  }
}
```

---

##### POST /api/v1/trades/sell
**åŠŸèƒ½**: å–å‡ºäº¤æ˜“

**è¯·æ±‚ä½“**:
```json
{
  "account_id": 1,
  "asset_symbol": "600000",
  "quantity": 50,
  "price": 13.00
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "trade_id": 1002,
    "account_id": 1,
    "asset_id": 5,
    "asset_symbol": "600000",
    "asset_name": "æµ¦å‘é“¶è¡Œ",
    "trade_type": "SELL",
    "quantity": 50,
    "price": 13.00,
    "total_amount": 650.00,
    "profit": 25.00,
    "profit_rate": 4.0,
    "trade_time": "2025-10-23T15:00:00Z",
    "account_balance_after": 99400.00
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
1. éªŒè¯æŒä»“å­˜åœ¨
2. éªŒè¯æŒä»“æ•°é‡å……è¶³: `holding_quantity >= sell_quantity`
3. è®¡ç®—å–å‡ºé‡‘é¢: `total_amount = quantity * price`
4. è®¡ç®—ç›ˆäº: `profit = (price - avg_price) * quantity`
5. å¢åŠ ä½™é¢
6. åˆ›å»ºäº¤æ˜“è®°å½•
7. å‡å°‘æŒä»“æ•°é‡ (å¦‚æœå–å®Œåˆ™åˆ é™¤æŒä»“è®°å½•)

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_HOLDINGS",
    "message": "æŒä»“æ•°é‡ä¸è¶³ï¼Œå½“å‰æŒä»“: 30, å°è¯•å–å‡º: 50"
  }
}
```

---

##### GET /api/v1/trades/{account_id}
**åŠŸèƒ½**: è·å–äº¤æ˜“å†å²

**æŸ¥è¯¢å‚æ•°**:
- `trade_type`: äº¤æ˜“ç±»å‹ (BUY/SELLï¼Œå¯é€‰)
- `asset_symbol`: èµ„äº§ä»£ç  (å¯é€‰)
- `start_date`: å¼€å§‹æ—¥æœŸ (å¯é€‰)
- `end_date`: ç»“æŸæ—¥æœŸ (å¯é€‰)
- `page`: é¡µç  (é»˜è®¤: 1)
- `page_size`: æ¯é¡µæ•°é‡ (é»˜è®¤: 20)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "trades": [
      {
        "id": 1002,
        "trade_type": "SELL",
        "asset_symbol": "600000",
        "asset_name": "æµ¦å‘é“¶è¡Œ",
        "quantity": 50,
        "price": 13.00,
        "total_amount": 650.00,
        "trade_time": "2025-10-23T15:00:00Z"
      },
      {
        "id": 1001,
        "trade_type": "BUY",
        "asset_symbol": "600000",
        "asset_name": "æµ¦å‘é“¶è¡Œ",
        "quantity": 100,
        "price": 12.50,
        "total_amount": 1250.00,
        "trade_time": "2025-10-23T14:30:00Z"
      }
    ],
    "total": 2,
    "page": 1,
    "page_size": 20
  }
}
```

---

#### 4.3.3 æŒä»“ç®¡ç† API

##### GET /api/v1/holdings/{account_id}
**åŠŸèƒ½**: è·å–è´¦æˆ·æŒä»“åˆ—è¡¨

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "holdings": [
      {
        "id": 1,
        "asset_id": 5,
        "asset_symbol": "600000",
        "asset_name": "æµ¦å‘é“¶è¡Œ",
        "quantity": 50,
        "avg_price": 12.50,
        "current_price": 13.00,
        "cost": 625.00,
        "market_value": 650.00,
        "profit": 25.00,
        "profit_rate": 4.0
      }
    ],
    "summary": {
      "total_cost": 625.00,
      "total_market_value": 650.00,
      "total_profit": 25.00,
      "total_profit_rate": 4.0
    }
  }
}
```

**è®¡ç®—é€»è¾‘**:
- `cost` = `quantity * avg_price`
- `market_value` = `quantity * current_price`
- `profit` = `market_value - cost`
- `profit_rate` = (`profit / cost`) * 100

---

##### GET /api/v1/holdings/{account_id}/summary
**åŠŸèƒ½**: è·å–æŒä»“æ±‡æ€»

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "account_balance": 98750.00,
    "total_market_value": 650.00,
    "total_assets": 99400.00,
    "total_cost": 625.00,
    "total_profit": 25.00,
    "total_profit_rate": 4.0,
    "holdings_count": 1,
    "asset_allocation": [
      {
        "asset_type": "è‚¡ç¥¨",
        "market_value": 650.00,
        "percentage": 100.0
      }
    ]
  }
}
```

---

#### 4.3.4 èµ„äº§æ•°æ® API

##### GET /api/v1/assets
**åŠŸèƒ½**: è·å–å¯äº¤æ˜“èµ„äº§åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°**:
- `asset_type`: èµ„äº§ç±»å‹ (è‚¡ç¥¨/åŸºé‡‘/è™šæ‹Ÿè´§å¸ï¼Œå¯é€‰)
- `exchange`: äº¤æ˜“æ‰€ (å¯é€‰)
- `keyword`: æœç´¢å…³é”®è¯ (ä»£ç æˆ–åç§°ï¼Œå¯é€‰)
- `page`: é¡µç  (é»˜è®¤: 1)
- `page_size`: æ¯é¡µæ•°é‡ (é»˜è®¤: 50)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "assets": [
      {
        "id": 5,
        "symbol": "600000",
        "name": "æµ¦å‘é“¶è¡Œ",
        "exchange": "ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€",
        "asset_type": "è‚¡ç¥¨",
        "current_price": 13.00,
        "created_at": "2025-10-20T00:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 50
  }
}
```

---

##### GET /api/v1/assets/{symbol}
**åŠŸèƒ½**: è·å–èµ„äº§è¯¦æƒ…

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 5,
    "symbol": "600000",
    "name": "æµ¦å‘é“¶è¡Œ",
    "exchange": "ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€",
    "asset_type": "è‚¡ç¥¨",
    "current_price": 13.00,
    "open_price": 12.80,
    "high_price": 13.20,
    "low_price": 12.75,
    "volume": 1500000,
    "change": 0.20,
    "change_percent": 1.56,
    "updated_at": "2025-10-23T15:00:00Z"
  }
}
```

---

##### GET /api/v1/assets/{symbol}/price
**åŠŸèƒ½**: è·å–å®æ—¶ä»·æ ¼ (ç”¨äºäº¤æ˜“å‰ç¡®è®¤)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "symbol": "600000",
    "price": 13.00,
    "timestamp": "2025-10-23T15:00:00Z"
  }
}
```

---

### 4.4 é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  |
|--------|------|-----------|
| ACCOUNT_NOT_FOUND | è´¦æˆ·ä¸å­˜åœ¨ | 404 |
| ASSET_NOT_FOUND | èµ„äº§ä¸å­˜åœ¨ | 404 |
| INSUFFICIENT_BALANCE | ä½™é¢ä¸è¶³ | 400 |
| INSUFFICIENT_HOLDINGS | æŒä»“ä¸è¶³ | 400 |
| INVALID_QUANTITY | äº¤æ˜“æ•°é‡æ— æ•ˆ | 400 |
| INVALID_PRICE | ä»·æ ¼æ— æ•ˆ | 400 |
| ACCOUNT_LIMIT_REACHED | è´¦æˆ·æ•°é‡è¾¾åˆ°ä¸Šé™ | 400 |
| TRADE_FAILED | äº¤æ˜“æ‰§è¡Œå¤±è´¥ | 500 |
| DATABASE_ERROR | æ•°æ®åº“é”™è¯¯ | 500 |

---

## 5. å‰ç«¯ç•Œé¢è®¾è®¡

### 5.1 é¡µé¢ç»“æ„

```
/trading (æ¨¡æ‹Ÿäº¤æ˜“ä¸»é¡µ)
  â”œâ”€â”€ /trading/accounts (è´¦æˆ·ç®¡ç†)
  â”œâ”€â”€ /trading/trade (äº¤æ˜“ç•Œé¢)
  â”œâ”€â”€ /trading/holdings (æŒä»“ç®¡ç†)
  â””â”€â”€ /trading/history (äº¤æ˜“å†å²)
```

### 5.2 æ ¸å¿ƒé¡µé¢è®¾è®¡

#### 5.2.1 äº¤æ˜“ä¸»é¡µ (`/trading`)

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         é¡¶éƒ¨å¯¼èˆªæ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è´¦æˆ·æ€»è§ˆå¡ç‰‡                                          â”‚ â”‚
â”‚  â”‚  - è´¦æˆ·åç§°: æˆ‘çš„ç¬¬ä¸€ä¸ªè´¦æˆ·                            â”‚ â”‚
â”‚  â”‚  - æ€»èµ„äº§: Â¥125,000.00  (+10.0%)                      â”‚ â”‚
â”‚  â”‚  - å¯ç”¨ä½™é¢: Â¥85,000.00                                â”‚ â”‚
â”‚  â”‚  - æŒä»“å¸‚å€¼: Â¥40,000.00                                â”‚ â”‚
â”‚  â”‚  - ä»Šæ—¥ç›ˆäº: +Â¥500.00 (+0.4%)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å¿«é€Ÿäº¤æ˜“é¢æ¿                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚  â”‚   ä¹°å…¥ BUY   â”‚  â”‚  å–å‡º SELL   â”‚  (Tabåˆ‡æ¢)        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  è‚¡ç¥¨ä»£ç : [______] (å¸¦æœç´¢å»ºè®®)                       â”‚ â”‚
â”‚  â”‚  å½“å‰ä»·æ ¼: Â¥13.00                                       â”‚ â”‚
â”‚  â”‚  äº¤æ˜“æ•°é‡: [______] æ‰‹                                  â”‚ â”‚
â”‚  â”‚  äº¤æ˜“é‡‘é¢: Â¥1,300.00                                    â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  [ç¡®è®¤ä¹°å…¥]  [å–æ¶ˆ]                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å½“å‰æŒä»“ (å‰5æ¡)                          [æŸ¥çœ‹æ›´å¤š]   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ä»£ç    â”‚ åç§°   â”‚ æ•°é‡ â”‚ æˆæœ¬ â”‚ ç°ä»· â”‚ ç›ˆäº      â”‚ â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚  â”‚ 600000â”‚æµ¦å‘é“¶è¡Œâ”‚ 100 â”‚12.50â”‚13.00â”‚+Â¥50 (+4%) â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æœ€è¿‘äº¤æ˜“ (å‰5æ¡)                          [æŸ¥çœ‹æ›´å¤š]   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚æ—¶é—´    â”‚ç±»å‹â”‚ä»£ç   â”‚åç§°  â”‚æ•°é‡â”‚ä»·æ ¼â”‚é‡‘é¢      â”‚ â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚  â”‚15:00  â”‚å–å‡ºâ”‚600000â”‚æµ¦å‘  â”‚ 50â”‚13.00â”‚Â¥650     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚14:30  â”‚ä¹°å…¥â”‚600000â”‚æµ¦å‘  â”‚100â”‚12.50â”‚Â¥1,250   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶æ¸…å•**:
- `AccountSummaryCard`: è´¦æˆ·æ€»è§ˆå¡ç‰‡
- `QuickTradePanel`: å¿«é€Ÿäº¤æ˜“é¢æ¿
  - `AssetSearchInput`: èµ„äº§æœç´¢è¾“å…¥æ¡†ï¼ˆå¸¦è‡ªåŠ¨å®Œæˆï¼‰
  - `PriceDisplay`: ä»·æ ¼æ˜¾ç¤ºç»„ä»¶
  - `QuantityInput`: æ•°é‡è¾“å…¥æ¡†
  - `TradeButton`: äº¤æ˜“æŒ‰é’®
- `HoldingsList`: æŒä»“åˆ—è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
- `RecentTradesList`: æœ€è¿‘äº¤æ˜“åˆ—è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰

---

#### 5.2.2 äº¤æ˜“ç•Œé¢ (`/trading/trade`)

**å¸ƒå±€**: å·¦å³åˆ†å±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å·¦ä¾§ï¼šèµ„äº§é€‰æ‹© & ä¿¡æ¯   â”‚  â”‚  å³ä¾§ï¼šäº¤æ˜“è¡¨å•        â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚  æœç´¢: [_____________]   â”‚  â”‚  [ä¹°å…¥] [å–å‡º] (Tab)   â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚  çƒ­é—¨è‚¡ç¥¨:               â”‚  â”‚  è‚¡ç¥¨: 600000 æµ¦å‘é“¶è¡Œ â”‚  â”‚
â”‚  â”‚  - 600000 æµ¦å‘é“¶è¡Œ       â”‚  â”‚  ç°ä»·: Â¥13.00          â”‚  â”‚
â”‚  â”‚  - 600036 æ‹›å•†é“¶è¡Œ       â”‚  â”‚  æ¶¨è·Œ: +Â¥0.20 (+1.56%) â”‚  â”‚
â”‚  â”‚  - 000001 å¹³å®‰é“¶è¡Œ       â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚  æ•°é‡: [______] æ‰‹     â”‚  â”‚
â”‚  â”‚  æˆ‘çš„æŒä»“:               â”‚  â”‚  å¯ç”¨: 100 æ‰‹          â”‚  â”‚
â”‚  â”‚  - 600000 æµ¦å‘é“¶è¡Œ       â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚    æŒä»“100æ‰‹             â”‚  â”‚  é¢„ä¼°é‡‘é¢: Â¥1,300.00   â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚  æ‰‹ç»­è´¹: Â¥0.00         â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚  å®é™…é‡‘é¢: Â¥1,300.00   â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚  [ç¡®è®¤äº¤æ˜“]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’é€»è¾‘**:
1. å·¦ä¾§ç‚¹å‡»èµ„äº§ â†’ è‡ªåŠ¨å¡«å……å³ä¾§è¡¨å•
2. è¾“å…¥æ•°é‡ â†’ å®æ—¶è®¡ç®—é¢„ä¼°é‡‘é¢
3. ç‚¹å‡»"ç¡®è®¤äº¤æ˜“" â†’ æ˜¾ç¤ºç¡®è®¤å¼¹çª— â†’ è°ƒç”¨ API â†’ æ˜¾ç¤ºç»“æœ
4. äº¤æ˜“æˆåŠŸ â†’ Toast æç¤º â†’ åˆ·æ–°è´¦æˆ·ä½™é¢å’ŒæŒä»“

---

#### 5.2.3 æŒä»“ç®¡ç† (`/trading/holdings`)

**è¡¨æ ¼åˆ—**:
- è‚¡ç¥¨ä»£ç 
- è‚¡ç¥¨åç§°
- æŒä»“æ•°é‡
- æˆæœ¬ä»·
- å½“å‰ä»·
- å¸‚å€¼
- ç›ˆäºé‡‘é¢
- ç›ˆäºæ¯”ä¾‹
- æ“ä½œï¼ˆå¿«é€Ÿå–å‡ºï¼‰

**åŠŸèƒ½**:
- æ’åº: æŒ‰ç›ˆäºã€å¸‚å€¼ã€æ•°é‡æ’åº
- ç­›é€‰: æŒ‰èµ„äº§ç±»å‹ç­›é€‰
- è¯¦æƒ…: ç‚¹å‡»è¡Œå±•å¼€è¯¦ç»†ä¿¡æ¯ï¼ˆä¹°å…¥å†å²ã€æŒä»“åˆ†å¸ƒï¼‰
- æ“ä½œ: å¿«é€Ÿå–å‡ºæŒ‰é’® â†’ è·³è½¬åˆ°äº¤æ˜“é¡µé¢å¹¶é¢„å¡«

---

#### 5.2.4 äº¤æ˜“å†å² (`/trading/history`)

**ç­›é€‰æ¡ä»¶**:
- æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨
- äº¤æ˜“ç±»å‹: å…¨éƒ¨/ä¹°å…¥/å–å‡º
- è‚¡ç¥¨ä»£ç æœç´¢

**è¡¨æ ¼åˆ—**:
- äº¤æ˜“æ—¶é—´
- äº¤æ˜“ç±»å‹ï¼ˆå¸¦é¢œè‰²æ ‡è¯†ï¼‰
- è‚¡ç¥¨ä»£ç 
- è‚¡ç¥¨åç§°
- æ•°é‡
- ä»·æ ¼
- é‡‘é¢
- çŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰

**å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡º CSV (å¯é€‰)

---

#### 5.2.5 è´¦æˆ·ç®¡ç† (`/trading/accounts`)

**åŠŸèƒ½**:
- è´¦æˆ·åˆ—è¡¨å±•ç¤º
- åˆ›å»ºæ–°è´¦æˆ·ï¼ˆå¼¹çª—ï¼‰
- åˆ‡æ¢å½“å‰è´¦æˆ·
- é‡ç½®è´¦æˆ·ï¼ˆç¡®è®¤å¼¹çª—ï¼‰
- åˆ é™¤è´¦æˆ·ï¼ˆç¡®è®¤å¼¹çª—ï¼‰

---

### 5.3 å‰ç«¯æŠ€æœ¯å®ç°

#### 5.3.1 çŠ¶æ€ç®¡ç†

ä½¿ç”¨ **Zustand** è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†:

```typescript
// stores/tradingStore.ts
import create from 'zustand';

interface TradingState {
  currentAccount: Account | null;
  holdings: Holding[];
  recentTrades: Trade[];

  // Actions
  setCurrentAccount: (account: Account) => void;
  fetchHoldings: (accountId: number) => Promise<void>;
  executeTrade: (tradeData: TradeRequest) => Promise<void>;
}

export const useTradingStore = create<TradingState>((set, get) => ({
  currentAccount: null,
  holdings: [],
  recentTrades: [],

  setCurrentAccount: (account) => set({ currentAccount: account }),

  fetchHoldings: async (accountId) => {
    const response = await fetch(`/api/v1/holdings/${accountId}`);
    const data = await response.json();
    set({ holdings: data.data.holdings });
  },

  executeTrade: async (tradeData) => {
    // è°ƒç”¨äº¤æ˜“ API
    // æ›´æ–°çŠ¶æ€
  }
}));
```

#### 5.3.2 API è°ƒç”¨å°è£…

```typescript
// lib/api/trading.ts
import { apiClient } from './client';

export const tradingApi = {
  // è´¦æˆ·ç›¸å…³
  getAccount: (accountId: number) =>
    apiClient.get(`/accounts/${accountId}`),

  createAccount: (data: CreateAccountRequest) =>
    apiClient.post('/accounts', data),

  // äº¤æ˜“ç›¸å…³
  buyAsset: (data: BuyRequest) =>
    apiClient.post('/trades/buy', data),

  sellAsset: (data: SellRequest) =>
    apiClient.post('/trades/sell', data),

  getTradeHistory: (accountId: number, params?: TradeQueryParams) =>
    apiClient.get(`/trades/${accountId}`, { params }),

  // æŒä»“ç›¸å…³
  getHoldings: (accountId: number) =>
    apiClient.get(`/holdings/${accountId}`),

  // èµ„äº§ç›¸å…³
  searchAssets: (keyword: string) =>
    apiClient.get('/assets', { params: { keyword } }),

  getAssetPrice: (symbol: string) =>
    apiClient.get(`/assets/${symbol}/price`)
};
```

#### 5.3.3 è¡¨å•éªŒè¯

ä½¿ç”¨ **Zod** è¿›è¡Œè¡¨å•éªŒè¯:

```typescript
import { z } from 'zod';

export const buyTradeSchema = z.object({
  account_id: z.number().positive(),
  asset_symbol: z.string().min(6).max(6),
  quantity: z.number().positive().min(1),
  price: z.number().positive()
});

export type BuyTradeInput = z.infer<typeof buyTradeSchema>;
```

---

## 6. äº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘

### 6.1 äº¤æ˜“å¼•æ“ç±»è®¾è®¡

```python
# backend/services/trading_engine.py

from decimal import Decimal
from typing import Dict, Optional
from models import SimAccount, SimTrade, SimHolding, Asset

class TradingEngine:
    """äº¤æ˜“å¼•æ“æ ¸å¿ƒç±»"""

    async def execute_buy(
        self,
        account_id: int,
        asset_symbol: str,
        quantity: Decimal,
        price: Decimal
    ) -> Dict:
        """
        æ‰§è¡Œä¹°å…¥äº¤æ˜“

        Args:
            account_id: è´¦æˆ·ID
            asset_symbol: èµ„äº§ä»£ç 
            quantity: ä¹°å…¥æ•°é‡
            price: ä¹°å…¥ä»·æ ¼

        Returns:
            äº¤æ˜“ç»“æœå­—å…¸

        Raises:
            InsufficientBalanceError: ä½™é¢ä¸è¶³
            AssetNotFoundError: èµ„äº§ä¸å­˜åœ¨
        """
        # 1. æŸ¥è¯¢è´¦æˆ·
        account = await SimAccount.get(id=account_id)

        # 2. æŸ¥è¯¢èµ„äº§
        asset = await Asset.get(symbol=asset_symbol)

        # 3. è®¡ç®—äº¤æ˜“é‡‘é¢
        total_amount = quantity * price

        # 4. éªŒè¯ä½™é¢
        if account.current_balance < total_amount:
            raise InsufficientBalanceError(
                f"ä½™é¢ä¸è¶³: å½“å‰ {account.current_balance}, éœ€è¦ {total_amount}"
            )

        # 5. å¼€å¯äº‹åŠ¡
        async with in_transaction():
            # 6. æ‰£å‡ä½™é¢
            account.current_balance -= total_amount
            await account.save()

            # 7. åˆ›å»ºäº¤æ˜“è®°å½•
            trade = await SimTrade.create(
                account_id=account_id,
                asset_id=asset.id,
                trade_type="BUY",
                quantity=quantity,
                price=price
            )

            # 8. æ›´æ–°æŒä»“
            holding = await SimHolding.get_or_none(
                account_id=account_id,
                asset_id=asset.id
            )

            if holding:
                # å·²æœ‰æŒä»“ï¼šæ›´æ–°æ•°é‡å’Œæˆæœ¬ä»·
                new_quantity = holding.quantity + quantity
                new_avg_price = (
                    (holding.quantity * holding.avg_price + quantity * price)
                    / new_quantity
                )
                holding.quantity = new_quantity
                holding.avg_price = new_avg_price
                await holding.save()
            else:
                # æ–°å»ºæŒä»“
                holding = await SimHolding.create(
                    account_id=account_id,
                    asset_id=asset.id,
                    quantity=quantity,
                    avg_price=price
                )

        # 9. è¿”å›ç»“æœ
        return {
            "trade_id": trade.id,
            "account_id": account_id,
            "asset_symbol": asset_symbol,
            "asset_name": asset.name,
            "trade_type": "BUY",
            "quantity": quantity,
            "price": price,
            "total_amount": total_amount,
            "account_balance_after": account.current_balance
        }

    async def execute_sell(
        self,
        account_id: int,
        asset_symbol: str,
        quantity: Decimal,
        price: Decimal
    ) -> Dict:
        """
        æ‰§è¡Œå–å‡ºäº¤æ˜“

        Args:
            account_id: è´¦æˆ·ID
            asset_symbol: èµ„äº§ä»£ç 
            quantity: å–å‡ºæ•°é‡
            price: å–å‡ºä»·æ ¼

        Returns:
            äº¤æ˜“ç»“æœå­—å…¸

        Raises:
            InsufficientHoldingsError: æŒä»“ä¸è¶³
            HoldingNotFoundError: æŒä»“ä¸å­˜åœ¨
        """
        # 1. æŸ¥è¯¢èµ„äº§
        asset = await Asset.get(symbol=asset_symbol)

        # 2. æŸ¥è¯¢æŒä»“
        holding = await SimHolding.get_or_none(
            account_id=account_id,
            asset_id=asset.id
        )

        if not holding:
            raise HoldingNotFoundError(f"æœªæŒæœ‰èµ„äº§ {asset_symbol}")

        # 3. éªŒè¯æŒä»“æ•°é‡
        if holding.quantity < quantity:
            raise InsufficientHoldingsError(
                f"æŒä»“ä¸è¶³: å½“å‰ {holding.quantity}, å°è¯•å–å‡º {quantity}"
            )

        # 4. è®¡ç®—äº¤æ˜“é‡‘é¢å’Œç›ˆäº
        total_amount = quantity * price
        profit = (price - holding.avg_price) * quantity
        profit_rate = (profit / (holding.avg_price * quantity)) * 100

        # 5. å¼€å¯äº‹åŠ¡
        async with in_transaction():
            # 6. æŸ¥è¯¢è´¦æˆ·å¹¶å¢åŠ ä½™é¢
            account = await SimAccount.get(id=account_id)
            account.current_balance += total_amount
            await account.save()

            # 7. åˆ›å»ºäº¤æ˜“è®°å½•
            trade = await SimTrade.create(
                account_id=account_id,
                asset_id=asset.id,
                trade_type="SELL",
                quantity=quantity,
                price=price
            )

            # 8. æ›´æ–°æŒä»“
            if holding.quantity == quantity:
                # å…¨éƒ¨å–å‡ºï¼šåˆ é™¤æŒä»“è®°å½•
                await holding.delete()
            else:
                # éƒ¨åˆ†å–å‡ºï¼šå‡å°‘æ•°é‡
                holding.quantity -= quantity
                await holding.save()

        # 9. è¿”å›ç»“æœ
        return {
            "trade_id": trade.id,
            "account_id": account_id,
            "asset_symbol": asset_symbol,
            "asset_name": asset.name,
            "trade_type": "SELL",
            "quantity": quantity,
            "price": price,
            "total_amount": total_amount,
            "profit": profit,
            "profit_rate": profit_rate,
            "account_balance_after": account.current_balance
        }

    async def calculate_holding_profit(
        self,
        holding: SimHolding,
        current_price: Decimal
    ) -> Dict:
        """è®¡ç®—æŒä»“ç›ˆäº"""
        cost = holding.quantity * holding.avg_price
        market_value = holding.quantity * current_price
        profit = market_value - cost
        profit_rate = (profit / cost) * 100 if cost > 0 else 0

        return {
            "cost": cost,
            "market_value": market_value,
            "profit": profit,
            "profit_rate": profit_rate
        }
```

### 6.2 äº‹åŠ¡å¤„ç†

ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§:

```python
from tortoise.transactions import in_transaction

async def execute_trade_with_transaction():
    async with in_transaction() as connection:
        # æ‰€æœ‰æ•°æ®åº“æ“ä½œ
        # å¦‚æœä»»ä½•æ“ä½œå¤±è´¥ï¼Œè‡ªåŠ¨å›æ»š
        pass
```

### 6.3 å¹¶å‘æ§åˆ¶

ä½¿ç”¨è¡Œçº§é”é˜²æ­¢å¹¶å‘é—®é¢˜:

```python
# ä½¿ç”¨ SELECT FOR UPDATE é”å®šè´¦æˆ·è®°å½•
account = await SimAccount.select_for_update().get(id=account_id)
```

---

## 7. æŠ€æœ¯é€‰å‹

### 7.1 åç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|---------|------|
| Web æ¡†æ¶ | FastAPI | é«˜æ€§èƒ½ã€å¼‚æ­¥æ”¯æŒã€è‡ªåŠ¨æ–‡æ¡£ |
| ORM | Tortoise-ORM | FastAPI åŸç”Ÿå¼‚æ­¥æ”¯æŒã€ç±» Django ORM |
| æ•°æ®éªŒè¯ | Pydantic | FastAPI å†…ç½®ã€ç±»å‹å®‰å…¨ |
| æ•°æ®åº“ | PostgreSQL 14+ | æˆç†Ÿç¨³å®šã€æ”¯æŒäº‹åŠ¡ã€ACID |
| ç¼“å­˜ | Redis 7+ | é«˜æ€§èƒ½ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„ |
| ä»»åŠ¡é˜Ÿåˆ— | Celery (å¯é€‰) | å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆå¦‚è¡Œæƒ…æ›´æ–°ï¼‰ |

### 7.2 å‰ç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|---------|------|
| æ¡†æ¶ | Next.js 15 | å·²é€‰å®šã€SSR æ”¯æŒã€æ€§èƒ½ä¼˜ç§€ |
| UI åº“ | Ant Design / shadcn/ui | ç»„ä»¶ä¸°å¯Œã€ä¼ä¸šçº§ |
| çŠ¶æ€ç®¡ç† | Zustand | è½»é‡ã€ç®€å•ã€TypeScript å‹å¥½ |
| è¡¨å• | React Hook Form + Zod | æ€§èƒ½å¥½ã€éªŒè¯å¼ºå¤§ |
| å›¾è¡¨ | Recharts / ECharts | æ•°æ®å¯è§†åŒ–ï¼ˆæŒä»“é¥¼å›¾ã€æ”¶ç›Šæ›²çº¿ï¼‰ |
| è¯·æ±‚åº“ | Axios / Fetch | å·²æœ‰å°è£… |

### 7.3 å¼€å‘å·¥å…·

- **API æ–‡æ¡£**: FastAPI è‡ªåŠ¨ç”Ÿæˆ Swagger/OpenAPI
- **API æµ‹è¯•**: Bruno / Postman
- **æ•°æ®åº“ç®¡ç†**: DBeaver / pgAdmin
- **Mock æ•°æ®**: Faker (Python) / Mock Service Worker (å‰ç«¯)

---

## 8. å¼€å‘è®¡åˆ’

### 8.1 Week 7 (ç¬¬ä¸€å‘¨)

#### Day 1-2: åç«¯åŸºç¡€è®¾æ–½ âœ…
- [x] é…ç½®æ•°æ®åº“è¿æ¥ (Tortoise-ORM)
- [x] åˆ›å»º ORM Models
- [x] æ‰§è¡Œå»ºè¡¨è„šæœ¬
- [x] ç¼–å†™æ•°æ®åº“ seed è„šæœ¬ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
- [x] é…ç½® FastAPI é¡¹ç›®ç»“æ„
  ```
  backend/
  â”œâ”€â”€ main.py                    # FastAPI åº”ç”¨å…¥å£ âœ…
  â”œâ”€â”€ config.py                  # æ•°æ®åº“é…ç½® âœ…
  â”œâ”€â”€ exceptions.py              # è‡ªå®šä¹‰å¼‚å¸¸ç±» âœ…
  â”œâ”€â”€ utils.py                   # å·¥å…·å‡½æ•° âœ…
  â”œâ”€â”€ models/                    # ORM æ¨¡å‹ âœ…
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ user.py
  â”‚   â”œâ”€â”€ account.py
  â”‚   â”œâ”€â”€ trade.py
  â”‚   â”œâ”€â”€ holding.py
  â”‚   â””â”€â”€ asset.py
  â”œâ”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘æœåŠ¡ âœ…
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ account_service.py
  â”‚   â”œâ”€â”€ trade_service.py       # åŒ…å«äº¤æ˜“å¼•æ“é€»è¾‘
  â”‚   â””â”€â”€ asset_service.py
  â”œâ”€â”€ routers/                   # API è·¯ç”± âœ…
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ accounts.py
  â”‚   â”œâ”€â”€ trades.py
  â”‚   â”œâ”€â”€ holdings.py
  â”‚   â”œâ”€â”€ assets.py
  â”‚   â””â”€â”€ klines.py              # Kçº¿æ•°æ®API
  â”œâ”€â”€ schemas/                   # Pydantic æ•°æ®æ¨¡å‹ âœ…
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ requests.py
  â”‚   â”œâ”€â”€ responses.py
  â”‚   â””â”€â”€ kline.py
  â”œâ”€â”€ scripts/                   # å·¥å…·è„šæœ¬ âœ…
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â””â”€â”€ init_test_data.py
  â””â”€â”€ tests/                     # æµ‹è¯•ç›®å½•
      â””â”€â”€ __init__.py
  ```

#### Day 3-4: è´¦æˆ·å’Œèµ„äº§ API âœ…
- [x] å®ç°è´¦æˆ·ç®¡ç† API (åˆ›å»ºã€æŸ¥è¯¢ã€é‡ç½®ã€æ›´æ–°ã€åˆ é™¤)
  - POST `/api/v1/accounts` - åˆ›å»ºè´¦æˆ·
  - GET `/api/v1/accounts/{account_id}` - è·å–è´¦æˆ·è¯¦æƒ…
  - GET `/api/v1/accounts/user/{user_id}` - è·å–ç”¨æˆ·è´¦æˆ·åˆ—è¡¨
  - PUT `/api/v1/accounts/{account_id}/reset` - é‡ç½®è´¦æˆ·
  - PATCH `/api/v1/accounts/{account_id}` - æ›´æ–°è´¦æˆ·ä¿¡æ¯
  - DELETE `/api/v1/accounts/{account_id}` - åˆ é™¤è´¦æˆ·
- [x] å®ç°èµ„äº§ç®¡ç† API (åˆ—è¡¨ã€æœç´¢ã€è¯¦æƒ…)
  - GET `/api/v1/assets` - èµ„äº§åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢å’Œç­›é€‰ï¼‰
  - GET `/api/v1/assets/{symbol}` - è·å–èµ„äº§è¯¦æƒ…
- [x] å®ç° Kçº¿æ•°æ® API
  - GET `/api/v1/klines/{symbol}` - è·å–Kçº¿æ•°æ®
- [x] ç¼–å†™æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬ (`backend/scripts/init_test_data.py`)
- [x] ä½¿ç”¨ FastAPI è‡ªåŠ¨æ–‡æ¡£æµ‹è¯• API (Swagger UI)

#### Day 5-7: äº¤æ˜“å¼•æ“å’Œäº¤æ˜“ API âœ…
- [x] å®ç°äº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘ï¼ˆåœ¨ TradeService ä¸­ï¼‰
  - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯åŸå­æ€§ (`in_transaction`)
  - å®ç°å¹¶å‘æ§åˆ¶ï¼ˆäº‹åŠ¡éš”ç¦»ï¼‰
  - ç²¾ç¡®çš„ä½™é¢å’ŒæŒä»“è®¡ç®—ï¼ˆä½¿ç”¨ Decimal ç±»å‹ï¼‰
  - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æœºåˆ¶
- [x] å®ç°ä¹°å…¥äº¤æ˜“ API
  - POST `/api/v1/trades/buy` - æ‰§è¡Œä¹°å…¥
  - éªŒè¯ä½™é¢å……è¶³æ€§
  - è‡ªåŠ¨æ›´æ–°æˆ–åˆ›å»ºæŒä»“ï¼ˆè®¡ç®—å¹³å‡æˆæœ¬ä»·ï¼‰
- [x] å®ç°å–å‡ºäº¤æ˜“ API
  - POST `/api/v1/trades/sell` - æ‰§è¡Œå–å‡º
  - éªŒè¯æŒä»“å……è¶³æ€§
  - è‡ªåŠ¨å‡å°‘æˆ–åˆ é™¤æŒä»“
- [x] å®ç°äº¤æ˜“å†å² API
  - GET `/api/v1/trades/history` - æŸ¥è¯¢äº¤æ˜“è®°å½•
  - æ”¯æŒæŒ‰èµ„äº§ã€ç±»å‹ç­›é€‰
  - æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- [x] å®ç°å¼‚å¸¸å¤„ç†æœºåˆ¶
  - è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»ï¼ˆ`exceptions.py`ï¼‰
  - ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰

### 8.2 Week 8 (ç¬¬äºŒå‘¨)

#### Day 1-2: æŒä»“ç®¡ç† API âœ…
- [x] å®ç°æŒä»“æŸ¥è¯¢ API
  - GET `/api/v1/holdings/{account_id}` - è·å–æŒä»“åˆ—è¡¨
  - åŒ…å«æˆæœ¬ã€å¸‚å€¼ã€ç›ˆäºè®¡ç®—
- [x] å®ç°æŒä»“æ±‡æ€» API
  - GET `/api/v1/holdings/{account_id}/summary` - æŒä»“æ±‡æ€»
  - åŒ…å«æ€»èµ„äº§ã€æ€»ç›ˆäºã€èµ„äº§é…ç½®
- [x] å®ç°ç›ˆäºè®¡ç®—é€»è¾‘
  - æŒä»“æ¨¡å‹ä¸­çš„ `calculate_profit()` æ–¹æ³•
  - è´¦æˆ·æ¨¡å‹ä¸­çš„ `calculate_total_assets()` å’Œ `calculate_profit()` æ–¹æ³•
- [x] ä½¿ç”¨æ¨¡æ‹Ÿä»·æ ¼ï¼ˆAsset è¡¨çš„ current_price å­—æ®µï¼‰

#### Day 3-5: å‰ç«¯ç•Œé¢å¼€å‘ â³ (éƒ¨åˆ†å®Œæˆ)
- [x] åˆ›å»ºäº¤æ˜“ç›¸å…³ç»„ä»¶
  - `TradePanel.tsx` - ä¹°å…¥/å–å‡ºäº¤æ˜“é¢æ¿
  - `TradeConfirmDialog.tsx` - äº¤æ˜“ç¡®è®¤å¯¹è¯æ¡†
  - `TradeHistory.tsx` - äº¤æ˜“å†å²ç»„ä»¶
- [x] å®ç°çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰
  - åˆ›å»º `tradingStore` ç®¡ç†äº¤æ˜“çŠ¶æ€
- [x] å®ç°äº¤æ˜“è¡¨å•é€»è¾‘
  - è¡¨å•éªŒè¯
  - å®æ—¶é‡‘é¢è®¡ç®—
  - ä½™é¢å’ŒæŒä»“æ£€æŸ¥
- [ ] å®ç°å®Œæ•´é¡µé¢è·¯ç”±ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] å®ç°è´¦æˆ·æ€»è§ˆé¡µé¢ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] å®ç°æŒä»“åˆ—è¡¨é¡µé¢ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] å®ç°äº¤æ˜“å†å²é¡µé¢ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] å®ç°è´¦æˆ·ç®¡ç†é¡µé¢ï¼ˆå¾…å®Œå–„ï¼‰

#### Day 6-7: è”è°ƒå’Œä¼˜åŒ– â³ (è¿›è¡Œä¸­)
- [x] åŸºç¡€å‰åç«¯è”è°ƒ
- [x] é”™è¯¯å¤„ç†æœºåˆ¶
  - åç«¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†
  - å‰ç«¯é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º
- [x] è¡¨å•éªŒè¯å’Œç”¨æˆ·åé¦ˆ
- [ ] å®Œæ•´çš„å‰åç«¯é›†æˆæµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] UI/UX æ·±åº¦ä¼˜åŒ–ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] åŠ è½½çŠ¶æ€å’Œéª¨æ¶å±ï¼ˆå¾…å®Œå–„ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¾…å®Œå–„ï¼‰

---

## 9. æµ‹è¯•æ–¹æ¡ˆ

### 9.1 å•å…ƒæµ‹è¯•

**åç«¯ (pytest)**:
```python
# tests/test_trading_engine.py

import pytest
from services.trading_engine import TradingEngine

@pytest.mark.asyncio
async def test_execute_buy_success():
    """æµ‹è¯•ä¹°å…¥äº¤æ˜“æˆåŠŸ"""
    engine = TradingEngine()
    result = await engine.execute_buy(
        account_id=1,
        asset_symbol="600000",
        quantity=100,
        price=12.50
    )
    assert result["trade_type"] == "BUY"
    assert result["total_amount"] == 1250.00

@pytest.mark.asyncio
async def test_execute_buy_insufficient_balance():
    """æµ‹è¯•ä½™é¢ä¸è¶³"""
    engine = TradingEngine()
    with pytest.raises(InsufficientBalanceError):
        await engine.execute_buy(
            account_id=1,
            asset_symbol="600000",
            quantity=10000,
            price=12.50
        )
```

### 9.2 é›†æˆæµ‹è¯•

**API æµ‹è¯•**:
```python
# tests/test_api.py

from fastapi.testclient import TestClient
from main import app

client = TestClient(app)

def test_create_account():
    """æµ‹è¯•åˆ›å»ºè´¦æˆ·"""
    response = client.post("/api/v1/accounts", json={
        "user_id": 1,
        "account_name": "æµ‹è¯•è´¦æˆ·",
        "initial_balance": 100000.00
    })
    assert response.status_code == 201
    assert response.json()["success"] == True

def test_buy_trade():
    """æµ‹è¯•ä¹°å…¥äº¤æ˜“"""
    response = client.post("/api/v1/trades/buy", json={
        "account_id": 1,
        "asset_symbol": "600000",
        "quantity": 100,
        "price": 12.50
    })
    assert response.status_code == 200
    assert response.json()["data"]["trade_type"] == "BUY"
```

### 9.3 å‰ç«¯æµ‹è¯•

**ç»„ä»¶æµ‹è¯• (Jest + React Testing Library)**:
```typescript
// __tests__/TradeForm.test.tsx

import { render, screen, fireEvent } from '@testing-library/react';
import TradeForm from '@/components/TradeForm';

test('renders buy trade form', () => {
  render(<TradeForm tradeType="BUY" />);
  expect(screen.getByText('ä¹°å…¥')).toBeInTheDocument();
});

test('validates quantity input', async () => {
  render(<TradeForm tradeType="BUY" />);
  const quantityInput = screen.getByLabelText('æ•°é‡');
  fireEvent.change(quantityInput, { target: { value: '-10' } });
  expect(await screen.findByText('æ•°é‡å¿…é¡»å¤§äº0')).toBeInTheDocument();
});
```

### 9.4 æ€§èƒ½æµ‹è¯•

ä½¿ç”¨ **Locust** è¿›è¡Œè´Ÿè½½æµ‹è¯•:
```python
# locustfile.py

from locust import HttpUser, task, between

class TradingUser(HttpUser):
    wait_time = between(1, 3)

    @task(3)
    def get_holdings(self):
        self.client.get("/api/v1/holdings/1")

    @task(1)
    def execute_trade(self):
        self.client.post("/api/v1/trades/buy", json={
            "account_id": 1,
            "asset_symbol": "600000",
            "quantity": 10,
            "price": 12.50
        })
```

### 9.5 æµ‹è¯•æ•°æ®å‡†å¤‡

**æ•°æ®åº“ Seed è„šæœ¬**:
```python
# scripts/seed_data.py

async def seed_test_data():
    """ç”Ÿæˆæµ‹è¯•æ•°æ®"""
    # åˆ›å»ºæµ‹è¯•ç”¨æˆ·
    user = await User.create(
        username="testuser",
        email="test@example.com",
        password_hash="hashed_password"
    )

    # åˆ›å»ºæµ‹è¯•è´¦æˆ·
    account = await SimAccount.create(
        user_id=user.id,
        account_name="æµ‹è¯•è´¦æˆ·",
        initial_balance=100000.00,
        current_balance=100000.00
    )

    # åˆ›å»ºæµ‹è¯•èµ„äº§
    assets = [
        {"symbol": "600000", "name": "æµ¦å‘é“¶è¡Œ", "asset_type": "è‚¡ç¥¨"},
        {"symbol": "600036", "name": "æ‹›å•†é“¶è¡Œ", "asset_type": "è‚¡ç¥¨"},
        {"symbol": "000001", "name": "å¹³å®‰é“¶è¡Œ", "asset_type": "è‚¡ç¥¨"},
    ]

    for asset_data in assets:
        await Asset.create(**asset_data)
```

---

## 10. é£é™©æ§åˆ¶

### 10.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| ç²¾åº¦ä¸¢å¤± | èµ„é‡‘è®¡ç®—é”™è¯¯ | ä½¿ç”¨ Decimal ç±»å‹ï¼Œç¦æ­¢ float |
| å¹¶å‘é—®é¢˜ | æ•°æ®ä¸ä¸€è‡´ | æ•°æ®åº“äº‹åŠ¡ + è¡Œçº§é” |
| æ€§èƒ½ç“¶é¢ˆ | å“åº”æ…¢ | Redis ç¼“å­˜ + æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– |
| æ•°æ®åº“å®•æœº | æœåŠ¡ä¸å¯ç”¨ | ä¸»ä»å¤åˆ¶ + å®šæœŸå¤‡ä»½ |

### 10.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| ä½™é¢ä¸ºè´Ÿ | æ•°æ®é”™è¯¯ | äº¤æ˜“å‰ä¸¥æ ¼éªŒè¯ + æ•°æ®åº“çº¦æŸ |
| æŒä»“æ•°é‡é”™è¯¯ | è®¡ç®—é”™è¯¯ | äº‹åŠ¡ä¿è¯åŸå­æ€§ + å®šæœŸæ•°æ®æ ¡éªŒ |
| é‡å¤äº¤æ˜“ | èµ„é‡‘é”™è¯¯ | å¹‚ç­‰æ€§è®¾è®¡ + äº¤æ˜“IDå»é‡ |
| è¡Œæƒ…æ•°æ®å»¶è¿Ÿ | ç”¨æˆ·ä½“éªŒå·® | æ˜¾ç¤ºæ•°æ®æ—¶é—´æˆ³ + å…è´£å£°æ˜ |

### 10.3 åˆè§„é£é™©

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| è¢«è¯¯è®¤ä¸ºçœŸå®äº¤æ˜“å¹³å° | æ³•å¾‹é£é™© | æ˜ç¡®æ ‡æ³¨"æ¨¡æ‹Ÿ"å­—æ · |
| ç”¨æˆ·æŠ•è¯‰ | å£°èª‰é£é™© | å®Œå–„ç”¨æˆ·åè®® + é£é™©æç¤º |
| æ•°æ®æ³„éœ² | éšç§é£é™© | æ•°æ®åŠ å¯† + è®¿é—®æ§åˆ¶ |

### 10.4 æ•°æ®ä¸€è‡´æ€§ä¿éšœ

**æ¯æ—¥æ•°æ®æ ¡éªŒè„šæœ¬**:
```python
async def verify_data_consistency():
    """éªŒè¯æ•°æ®ä¸€è‡´æ€§"""
    accounts = await SimAccount.all()

    for account in accounts:
        # 1. è®¡ç®—æŒä»“æ€»å¸‚å€¼
        holdings = await SimHolding.filter(account_id=account.id)
        holdings_value = sum(h.quantity * h.avg_price for h in holdings)

        # 2. è®¡ç®—æ‰€æœ‰äº¤æ˜“çš„èµ„é‡‘æµæ°´
        trades = await SimTrade.filter(account_id=account.id)
        buy_total = sum(t.quantity * t.price for t in trades if t.trade_type == "BUY")
        sell_total = sum(t.quantity * t.price for t in trades if t.trade_type == "SELL")

        # 3. éªŒè¯ç­‰å¼: åˆå§‹èµ„é‡‘ - ä¹°å…¥é‡‘é¢ + å–å‡ºé‡‘é¢ + æŒä»“å¸‚å€¼ â‰ˆ å½“å‰æ€»èµ„äº§
        expected_total = account.initial_balance - buy_total + sell_total + holdings_value
        actual_total = account.current_balance + holdings_value

        if abs(expected_total - actual_total) > 0.01:
            logger.error(f"è´¦æˆ· {account.id} æ•°æ®ä¸ä¸€è‡´: é¢„æœŸ {expected_total}, å®é™… {actual_total}")
```

---

## 11. åç»­è¿­ä»£æ–¹å‘

### 11.1 çŸ­æœŸä¼˜åŒ– (Month 3)
- [ ] å®æ—¶ä»·æ ¼æ¨é€ (WebSocket)
- [ ] ç®€å• AI äº¤æ˜“å»ºè®®
- [ ] æŒä»“ç›ˆäºå›¾è¡¨å¯è§†åŒ–
- [ ] ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–

### 11.2 ä¸­æœŸæ‰©å±• (Month 4-6)
- [ ] é™ä»·å•ã€æ­¢æŸå•
- [ ] å›æµ‹åŠŸèƒ½
- [ ] é«˜çº§å›¾è¡¨é›†æˆ (TradingView)
- [ ] ç¤¾äº¤åŠŸèƒ½é›†æˆ (åˆ†äº«äº¤æ˜“)

### 11.3 é•¿æœŸè§„åˆ’ (Month 6+)
- [ ] å¤šè´¦æˆ·å¯¹æ¯”
- [ ] AI ç­–ç•¥æ¨è
- [ ] æœŸè´§ã€æœŸæƒæ¨¡æ‹Ÿ
- [ ] Bç«¯ API å¼€æ”¾

---

## é™„å½•

### A. æ•°æ®å­—å…¸

è¯¦è§æ•°æ®åº“è®¾è®¡éƒ¨åˆ†

### B. API æ¥å£æ±‡æ€»

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| åˆ›å»ºè´¦æˆ· | POST | /api/v1/accounts | åˆ›å»ºæ¨¡æ‹Ÿè´¦æˆ· |
| è·å–è´¦æˆ· | GET | /api/v1/accounts/{id} | è·å–è´¦æˆ·è¯¦æƒ… |
| ç”¨æˆ·è´¦æˆ·åˆ—è¡¨ | GET | /api/v1/accounts/user/{id} | è·å–ç”¨æˆ·æ‰€æœ‰è´¦æˆ· |
| é‡ç½®è´¦æˆ· | PUT | /api/v1/accounts/{id}/reset | é‡ç½®è´¦æˆ· |
| ä¹°å…¥äº¤æ˜“ | POST | /api/v1/trades/buy | æ‰§è¡Œä¹°å…¥ |
| å–å‡ºäº¤æ˜“ | POST | /api/v1/trades/sell | æ‰§è¡Œå–å‡º |
| äº¤æ˜“å†å² | GET | /api/v1/trades/{account_id} | è·å–äº¤æ˜“è®°å½• |
| æŒä»“åˆ—è¡¨ | GET | /api/v1/holdings/{account_id} | è·å–æŒä»“ |
| æŒä»“æ±‡æ€» | GET | /api/v1/holdings/{account_id}/summary | æŒä»“ç»Ÿè®¡ |
| èµ„äº§åˆ—è¡¨ | GET | /api/v1/assets | å¯äº¤æ˜“èµ„äº§ |
| èµ„äº§è¯¦æƒ… | GET | /api/v1/assets/{symbol} | èµ„äº§ä¿¡æ¯ |
| å®æ—¶ä»·æ ¼ | GET | /api/v1/assets/{symbol}/price | è·å–ä»·æ ¼ |

### C. é”™è¯¯å¤„ç†ç¤ºä¾‹

```python
# backend/exceptions.py

class TradingException(Exception):
    """äº¤æ˜“å¼‚å¸¸åŸºç±»"""
    def __init__(self, message: str, code: str):
        self.message = message
        self.code = code
        super().__init__(self.message)

class InsufficientBalanceError(TradingException):
    def __init__(self, message: str):
        super().__init__(message, "INSUFFICIENT_BALANCE")

class InsufficientHoldingsError(TradingException):
    def __init__(self, message: str):
        super().__init__(message, "INSUFFICIENT_HOLDINGS")

# å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@app.exception_handler(TradingException)
async def trading_exception_handler(request: Request, exc: TradingException):
    return JSONResponse(
        status_code=400,
        content={
            "success": False,
            "error": {
                "code": exc.code,
                "message": exc.message
            }
        }
    )
```

---

## 12. å®ç°çŠ¶æ€æ€»ç»“

### 12.1 å·²å®ŒæˆåŠŸèƒ½ âœ…

#### åç«¯æ ¸å¿ƒåŠŸèƒ½
1. **æ•°æ®åº“è®¾è®¡å’Œæ¨¡å‹** âœ…
   - âœ… Tortoise-ORM é›†æˆå’Œé…ç½®
   - âœ… å®Œæ•´çš„æ•°æ®æ¨¡å‹ï¼ˆUser, SimAccount, SimTrade, SimHolding, Assetï¼‰
   - âœ… å¤–é”®å…³ç³»å’Œç´¢å¼•ä¼˜åŒ–
   - âœ… Decimal ç²¾åº¦å¤„ç†

2. **è´¦æˆ·ç®¡ç†æœåŠ¡** âœ…
   - âœ… åˆ›å»ºè´¦æˆ·ï¼ˆPOST `/api/v1/accounts`ï¼‰
   - âœ… æŸ¥è¯¢è´¦æˆ·è¯¦æƒ…ï¼ˆGET `/api/v1/accounts/{account_id}`ï¼‰
   - âœ… æŸ¥è¯¢ç”¨æˆ·è´¦æˆ·åˆ—è¡¨ï¼ˆGET `/api/v1/accounts/user/{user_id}`ï¼‰
   - âœ… é‡ç½®è´¦æˆ·ï¼ˆPUT `/api/v1/accounts/{account_id}/reset`ï¼‰
   - âœ… æ›´æ–°è´¦æˆ·ï¼ˆPATCH `/api/v1/accounts/{account_id}`ï¼‰
   - âœ… åˆ é™¤è´¦æˆ·ï¼ˆDELETE `/api/v1/accounts/{account_id}`ï¼‰
   - âœ… è´¦æˆ·æ€»èµ„äº§å’Œç›ˆäºè®¡ç®—

3. **äº¤æ˜“å¼•æ“æ ¸å¿ƒ** âœ…
   - âœ… ä¹°å…¥äº¤æ˜“é€»è¾‘ï¼ˆ`TradeService.buy_asset()`ï¼‰
     - ä½™é¢éªŒè¯
     - æŒä»“è‡ªåŠ¨åˆ›å»º/æ›´æ–°
     - å¹³å‡æˆæœ¬ä»·è®¡ç®—
     - æ•°æ®åº“äº‹åŠ¡ä¿è¯åŸå­æ€§
   - âœ… å–å‡ºäº¤æ˜“é€»è¾‘ï¼ˆ`TradeService.sell_asset()`ï¼‰
     - æŒä»“éªŒè¯
     - æŒä»“è‡ªåŠ¨æ›´æ–°/åˆ é™¤
     - ç›ˆäºè®¡ç®—
   - âœ… äº¤æ˜“å†å²æŸ¥è¯¢ï¼ˆæ”¯æŒç­›é€‰å’Œåˆ†é¡µï¼‰

4. **æŒä»“ç®¡ç†æœåŠ¡** âœ…
   - âœ… æŒä»“åˆ—è¡¨æŸ¥è¯¢ï¼ˆGET `/api/v1/holdings/{account_id}`ï¼‰
   - âœ… æŒä»“æ±‡æ€»ç»Ÿè®¡ï¼ˆGET `/api/v1/holdings/{account_id}/summary`ï¼‰
   - âœ… æˆæœ¬ã€å¸‚å€¼ã€ç›ˆäºè‡ªåŠ¨è®¡ç®—
   - âœ… èµ„äº§é…ç½®åˆ†æ

5. **èµ„äº§ç®¡ç†æœåŠ¡** âœ…
   - âœ… èµ„äº§åˆ—è¡¨æŸ¥è¯¢ï¼ˆæ”¯æŒæœç´¢å’Œç­›é€‰ï¼‰
   - âœ… èµ„äº§è¯¦æƒ…æŸ¥è¯¢
   - âœ… Kçº¿æ•°æ®APIï¼ˆGET `/api/v1/klines/{symbol}`ï¼‰

6. **å¼‚å¸¸å¤„ç†æœºåˆ¶** âœ…
   - âœ… è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»ï¼ˆ`exceptions.py`ï¼‰
     - InsufficientBalanceErrorï¼ˆä½™é¢ä¸è¶³ï¼‰
     - InsufficientHoldingsErrorï¼ˆæŒä»“ä¸è¶³ï¼‰
     - AccountNotFoundErrorï¼ˆè´¦æˆ·ä¸å­˜åœ¨ï¼‰
     - AssetNotFoundErrorï¼ˆèµ„äº§ä¸å­˜åœ¨ï¼‰
     - ç­‰ç­‰...
   - âœ… ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

7. **æ•°æ®éªŒè¯** âœ…
   - âœ… Pydantic è¯·æ±‚æ¨¡å‹éªŒè¯
   - âœ… ä¸šåŠ¡é€»è¾‘éªŒè¯ï¼ˆä½™é¢ã€æŒä»“ã€æ•°é‡ç­‰ï¼‰

8. **æµ‹è¯•æ•°æ®** âœ…
   - âœ… æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬ï¼ˆ`backend/scripts/init_test_data.py`ï¼‰

#### å‰ç«¯æ ¸å¿ƒåŠŸèƒ½
1. **äº¤æ˜“ç•Œé¢ç»„ä»¶** âœ…
   - âœ… TradePanel - ä¹°å…¥/å–å‡ºäº¤æ˜“é¢æ¿
   - âœ… TradeConfirmDialog - äº¤æ˜“ç¡®è®¤å¯¹è¯æ¡†
   - âœ… TradeHistory - äº¤æ˜“å†å²ç»„ä»¶
   - âœ… è¡¨å•éªŒè¯å’Œå®æ—¶è®¡ç®—
   - âœ… é”™è¯¯æ¶ˆæ¯æ˜¾ç¤ºå’ŒæˆåŠŸåé¦ˆ

2. **çŠ¶æ€ç®¡ç†** âœ…
   - âœ… Zustand çŠ¶æ€ç®¡ç†ï¼ˆtradingStoreï¼‰
   - âœ… äº¤æ˜“æ‰§è¡Œé€»è¾‘ï¼ˆuseTrade Hookï¼‰

3. **UI/UX** âœ…
   - âœ… ä¹°å…¥/å–å‡ºTabåˆ‡æ¢
   - âœ… å®æ—¶é‡‘é¢è®¡ç®—
   - âœ… ä½™é¢å’ŒæŒä»“æ˜¾ç¤º
   - âœ… æˆåŠŸ/é”™è¯¯æ¶ˆæ¯æç¤º

---

### 12.2 å¾…å®Œå–„åŠŸèƒ½ ğŸ“

#### åç«¯å¾…å®Œå–„
1. **æµ‹è¯•** âš ï¸
   - âŒ å•å…ƒæµ‹è¯•ï¼ˆpytestï¼‰
   - âŒ é›†æˆæµ‹è¯•
   - âŒ æ€§èƒ½æµ‹è¯•ï¼ˆLocustï¼‰
   - âŒ æ•°æ®ä¸€è‡´æ€§éªŒè¯è„šæœ¬

2. **å®æ—¶ä»·æ ¼** âš ï¸
   - âš ï¸ å½“å‰ä½¿ç”¨ Asset è¡¨çš„é™æ€ä»·æ ¼
   - âŒ å¯¹æ¥çœŸå®è¡Œæƒ…æ•°æ®æº
   - âŒ WebSocket å®æ—¶æ¨é€
   - âŒ Redis ä»·æ ¼ç¼“å­˜

3. **é«˜çº§åŠŸèƒ½** âŒ
   - âŒ é™ä»·å•ã€æ­¢æŸå•
   - âŒ äº¤æ˜“æ‰‹ç»­è´¹è®¡ç®—
   - âŒ æ’¤å•åŠŸèƒ½
   - âŒ AI äº¤æ˜“å»ºè®®

4. **ç›‘æ§å’Œæ—¥å¿—** âš ï¸
   - âŒ äº¤æ˜“æ—¥å¿—è®°å½•
   - âŒ æ€§èƒ½ç›‘æ§
   - âŒ å¼‚å¸¸å‘Šè­¦

#### å‰ç«¯å¾…å®Œå–„
1. **é¡µé¢å®Œæ•´æ€§** âš ï¸
   - âŒ å®Œæ•´çš„é¡µé¢è·¯ç”±ç»“æ„
   - âŒ è´¦æˆ·æ€»è§ˆé¡µé¢
   - âŒ æŒä»“åˆ—è¡¨é¡µé¢ï¼ˆå®Œæ•´ç‰ˆï¼‰
   - âŒ äº¤æ˜“å†å²é¡µé¢ï¼ˆå®Œæ•´ç‰ˆï¼‰
   - âŒ è´¦æˆ·ç®¡ç†é¡µé¢

2. **å›¾è¡¨å¯è§†åŒ–** âŒ
   - âŒ Kçº¿å›¾é›†æˆ
   - âŒ æŒä»“é¥¼å›¾
   - âŒ æ”¶ç›Šæ›²çº¿å›¾
   - âŒ æŠ€æœ¯æŒ‡æ ‡

3. **ç”¨æˆ·ä½“éªŒ** âš ï¸
   - âŒ åŠ è½½çŠ¶æ€å’Œéª¨æ¶å±
   - âŒ æ•°æ®åˆ·æ–°æœºåˆ¶
   - âŒ å“åº”å¼è®¾è®¡ä¼˜åŒ–
   - âŒ å¿«æ·é”®æ”¯æŒ

4. **æœç´¢åŠŸèƒ½** âš ï¸
   - âŒ è‚¡ç¥¨æœç´¢è‡ªåŠ¨å®Œæˆ
   - âŒ æœç´¢å†å²è®°å½•
   - âŒ çƒ­é—¨è‚¡ç¥¨æ¨è

---

### 12.3 æŠ€æœ¯äº®ç‚¹ â­

1. **æ•°æ®ç²¾åº¦ä¿è¯**
   - å…¨é¢ä½¿ç”¨ Python `Decimal` ç±»å‹
   - é¿å…æµ®ç‚¹æ•°ç²¾åº¦æŸå¤±
   - ç¡®ä¿èµ„é‡‘è®¡ç®—100%å‡†ç¡®

2. **äº‹åŠ¡ä¸€è‡´æ€§**
   - ä½¿ç”¨ Tortoise-ORM çš„ `in_transaction()`
   - ç¡®ä¿äº¤æ˜“æ“ä½œçš„åŸå­æ€§
   - é˜²æ­¢å¹¶å‘é—®é¢˜

3. **å¹³å‡æˆæœ¬ä»·è®¡ç®—**
   - ä¹°å…¥æ—¶è‡ªåŠ¨è®¡ç®—åŠ æƒå¹³å‡æˆæœ¬ä»·
   - å…¬å¼ï¼š`new_avg_price = (old_cost + new_cost) / new_quantity`

4. **æŒä»“è‡ªåŠ¨ç®¡ç†**
   - ä¹°å…¥æ—¶è‡ªåŠ¨åˆ›å»ºæˆ–æ›´æ–°æŒä»“
   - å–å‡ºæ—¶è‡ªåŠ¨å‡å°‘æˆ–åˆ é™¤æŒä»“
   - æ•°é‡ä¸º0è‡ªåŠ¨æ¸…ç†è®°å½•

5. **å®Œå–„çš„é”™è¯¯å¤„ç†**
   - è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ä½“ç³»
   - ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
   - å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

6. **API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ**
   - FastAPI è‡ªåŠ¨ç”Ÿæˆ Swagger UI
   - Pydantic æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç¤ºä¾‹
   - å®æ—¶åœ¨çº¿æµ‹è¯•

---

### 12.4 ä¸‹ä¸€æ­¥è®¡åˆ’ ğŸš€

#### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰
1. âœ… å®Œæˆå‰ç«¯å®Œæ•´é¡µé¢å¼€å‘
2. âœ… å®ç°æ•°æ®å®æ—¶åˆ·æ–°
3. âœ… æ·»åŠ åŸºç¡€å›¾è¡¨ï¼ˆæŒä»“é¥¼å›¾ã€æ”¶ç›Šæ›²çº¿ï¼‰
4. âœ… å®Œå–„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
5. âœ… ç¼–å†™åŸºç¡€å•å…ƒæµ‹è¯•

#### ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰
1. âœ… å¯¹æ¥çœŸå®è¡Œæƒ…æ•°æ®
2. âœ… å®ç° WebSocket å®æ—¶æ¨é€
3. âœ… é›†æˆ TradingView å›¾è¡¨åº“
4. âœ… å®ç°é«˜çº§è®¢å•ç±»å‹
5. âœ… æ·»åŠ äº¤æ˜“æ‰‹ç»­è´¹

#### é•¿æœŸç›®æ ‡ï¼ˆ2-3ä¸ªæœˆï¼‰
1. âœ… AI äº¤æ˜“å»ºè®®åŠŸèƒ½
2. âœ… å›æµ‹ç³»ç»Ÿ
3. âœ… ç¤¾äº¤åŠŸèƒ½é›†æˆï¼ˆåˆ†äº«äº¤æ˜“ï¼‰
4. âœ… ç§»åŠ¨ç«¯é€‚é…
5. âœ… æ€§èƒ½ä¼˜åŒ–å’Œå‹æµ‹

---

## æ–‡æ¡£æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|---------|
| v1.0 | 2025-10-23 | Claude Code | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´è®¾è®¡æ–¹æ¡ˆ |
| v1.1 | 2025-10-27 | Claude Code | æ›´æ–°å®ç°çŠ¶æ€ï¼Œæ ‡æ³¨å·²å®ŒæˆåŠŸèƒ½ |

---

**ğŸ¯ MVP æ ¸å¿ƒåŠŸèƒ½å·²åŸºæœ¬å®Œæˆï¼ç»§ç»­å®Œå–„å‰ç«¯ç•Œé¢å’Œå›¾è¡¨åŠŸèƒ½ï¼**
